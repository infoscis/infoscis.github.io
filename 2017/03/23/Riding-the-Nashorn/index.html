<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>JVM에서 JavaScript 프로그램 하기(Nashorn에 대한 소개) | Developer&#39;s Record</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Java,JavaScript,Nashorn" />
    
    <meta name="description" content="의역, 오역, 직역이 있을 수 있음을 알려드립니다.이 포스트는 원저자의 동의를 얻어 한글로 번역한 내용입니다.
This post is a translation of this original article Riding the Nashorn: Programming JavaScript on the JVM by Niko Köbler from http://www.">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM에서 JavaScript 프로그램 하기(Nashorn에 대한 소개)">
<meta property="og:url" content="http://infoscis.github.io/2017/03/23/Riding-the-Nashorn/index.html">
<meta property="og:site_name" content="Developer's Record">
<meta property="og:description" content="의역, 오역, 직역이 있을 수 있음을 알려드립니다.이 포스트는 원저자의 동의를 얻어 한글로 번역한 내용입니다.
This post is a translation of this original article Riding the Nashorn: Programming JavaScript on the JVM by Niko Köbler from http://www.">
<meta property="og:image" content="http://www.n-k.de/riding-the-nashorn/images/nashorn.jpg">
<meta property="og:updated_time" content="2018-01-27T14:52:35.932Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JVM에서 JavaScript 프로그램 하기(Nashorn에 대한 소개)">
<meta name="twitter:description" content="의역, 오역, 직역이 있을 수 있음을 알려드립니다.이 포스트는 원저자의 동의를 얻어 한글로 번역한 내용입니다.
This post is a translation of this original article Riding the Nashorn: Programming JavaScript on the JVM by Niko Köbler from http://www.">
<meta name="twitter:image" content="http://www.n-k.de/riding-the-nashorn/images/nashorn.jpg">
    
    <link rel="canonical" href="http://infoscis.github.io/2017/03/23/Riding-the-Nashorn/"/>

    

    
        <link rel="icon" href="/favicon.png" />
    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.0.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-100332906-1', 'auto');
ga('send', 'pageview');

</script>
    
    

</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">개발자의 기록 보관소</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">홈</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Angular/">Angular</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Hadoop/">Hadoop</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Java/">Java</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Java/Java9/">Java9</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Java/Spring/">Spring</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/JavaScript/">JavaScript</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/JavaScript/ECMAScript-2015/">ECMAScript 2015</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/TypeScript/">TypeScript</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Webpack/">Webpack</a></li></ul>
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="https://about.me/jongcheol.kim">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="검색" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '포스트',
            PAGES: 'Pages',
            CATEGORIES: '카테고리',
            TAGS: '태그',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Java/">Java</a>
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-Riding-the-Nashorn" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        JVM에서 JavaScript 프로그램 하기(Nashorn에 대한 소개)
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2017/03/23/Riding-the-Nashorn/" class="article-date">
            <time datetime="2017-03-23T14:57:25.000Z" itemprop="datePublished">2017-03-23</time>
        </a>
    </div>

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Java/">Java</a>, <a class="tag-link" href="/tags/JavaScript/">JavaScript</a>, <a class="tag-link" href="/tags/Nashorn/">Nashorn</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <blockquote>
<p>의역, 오역, 직역이 있을 수 있음을 알려드립니다.<br>이 포스트는 원저자의 동의를 얻어 한글로 번역한 내용입니다.</p>
<p>This post is a translation of this original article <a href="http://www.n-k.de/riding-the-nashorn/" target="_blank" rel="external">Riding the Nashorn: Programming JavaScript on the JVM</a> by Niko Köbler from <a href="http://www.n-k.de" target="_blank" rel="external">http://www.n-k.de</a><br>Original article: <a href="http://www.n-k.de/riding-the-nashorn/" target="_blank" rel="external">Riding the Nashorn: Programming JavaScript on the JVM</a></p>
<p>Author: Niko Köbler<br>Author Email: niko@n-k.de<br>Author Blog: <a href="http://www.n-k.de" target="_blank" rel="external">http://www.n-k.de</a><br>Author Twitter: @dasniko</p>
</blockquote>
<hr>
<p>Nashorn은 Java8 버전 부터 Java Virtual Machine의 공식 JavaScript 엔진입니다.<br>ECMAScript 5.1 사양에 따라 구현되었으며 Google V8 (Node.js의 스크립트 엔진)과 경쟁합니다.<br>Nashorn은 런타임 동안 JavaScript를 Java 바이트 코드로 컴파일하기 때문에 Java와 JavaScript의 사이의 높은 상호 운용성을 제공합니다.</p>
<p><img src="http://www.n-k.de/riding-the-nashorn/images/nashorn.jpg" alt=""></p>
<p>이 글은 Nashorn에서 가장 많이 사용 되는 Option, Function, Feature와 그리고 Use case에 대해 살펴 보려고합니다.<br>이 튜토리얼을 읽은 후에는 일반 Java 프로그램에서 Nashorn을 이용하여 JavaScript 동적 스크립팅 기능을 사용할 수 있을 것으로 기대합니다.</p>
<p>Nashorn을 공부하기 위한 또 다른 좋은 방법은 <a href="http://openjdk.java.net/projects/nashorn/" target="_blank" rel="external">Official Project Nashorn</a> 웹 사이트이며, 공식 웹사이트에는 메일 링리스트, 블로그 및 wiki 페이지들이 있습니다. 바로 확인해 보세요.</p>
<blockquote>
<p>JDK 8의 Nashorn은 위에 언급 한대로 ECMAScript 5.1 사양을 구현했습니다.<br>Nashorn의 전략은 ECMAScript 사양을 따르는 것입니다. 그렇기 때문에 Nashorn의 주요 후속 버전에서는 ECMAScript 2015 spec을 구현할 예정입니다.</p>
</blockquote>
<h2 id="1-Nashorn의-Command-Line-Interface-CLI"><a href="#1-Nashorn의-Command-Line-Interface-CLI" class="headerlink" title="1. Nashorn의 Command Line Interface (CLI)"></a>1. Nashorn의 Command Line Interface (CLI)</h2><p>Nashorn은 <code>jjs</code>라는 명령행 클라이언트(CLI)를 제공합니다.</p>
<p>이 <code>jjs</code>는 $JAVA_HOME/bin에 위치해 있지만, 바로가기/링크/Path등의 설정이 Java 8 설치 기능에 포함되어 있지 않습니다. 따라서 <code>jjs</code>로 작업하기를 원한다면 아래와 같이 <code>jjs</code> 링크를 설정해야 합니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$ cd /usr/bin</div><div class="line">$ ln -s $JAVA_HOME/bin/jjs jjs</div><div class="line">$ jjs</div><div class="line">jjs&gt; print(&apos;Hello World&apos;);</div></pre></td></tr></table></figure>
<blockquote>
<p>환경변수의 PATH에 <code>$JAVA_HOME/bin</code>을 추가하면 따로 설정할 필요가 없습니다.</p>
</blockquote>
<p>이제 <code>jjs</code> 쉘에서 직접 JavaScript 코드를 실행할 수 있습니다.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">jjs&gt; <span class="keyword">var</span> x = <span class="number">10</span>;</div><div class="line">jjs&gt; print(x);</div><div class="line"><span class="number">10</span></div></pre></td></tr></table></figure></p>
<p>그리고 <code>jjs</code>를 이용하여 파일로 저장되어 있는 JavaScript를 로드하고 실행할 수 있습니다.</p>
<p><em>test.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = <span class="number">10</span>;</div><div class="line"><span class="keyword">var</span> y = <span class="number">20</span>;</div><div class="line">print(x + y);</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ jjs test.js</div><div class="line">30</div></pre></td></tr></table></figure>
<h5 id="jjs-종료"><a href="#jjs-종료" class="headerlink" title="jjs 종료"></a>jjs 종료</h5><p><code>jjs</code> 클라이언트는 아래와 같은 함수를 호출하여 종료할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">jjs&gt; exit()  <span class="comment">// 일반적인 종료</span></div><div class="line">jjs&gt; exit(<span class="number">1</span>) <span class="comment">// 종료 코드를 포함한 종료</span></div><div class="line"></div><div class="line">jjs&gt; quit()  <span class="comment">// 일반적인 종료</span></div><div class="line">jjs&gt; quit(<span class="number">1</span>) <span class="comment">// 종료 코드를 포함한 종료</span></div></pre></td></tr></table></figure>
<h5 id="도움말-옵션"><a href="#도움말-옵션" class="headerlink" title="도움말 / 옵션"></a>도움말 / 옵션</h5><p>-help 옵션을 사용하면 <code>jjs</code>의 모든 옵션이 나열됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jjs -help</div></pre></td></tr></table></figure>
<h3 id="1-1-Scripting-모드"><a href="#1-1-Scripting-모드" class="headerlink" title="1.1. Scripting 모드"></a>1.1. Scripting 모드</h3><p>Nashorn은 ECMAScript 5.1 사양 외에도 자체 구문및 확장 API를 구현했습니다. (다음 장 참조).<br>이러한 확장 기능의 대부분은 스크립팅 모드에서만 사용할 수 있습니다.<br>스크립팅 모드는 cli의 <em>-scripting</em> 옵션을 사용하여 활성화 됩니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jjs -scripting</div></pre></td></tr></table></figure>
<p>스크립팅 모드에서 Nashorn은 Shell 스타일의 ‘#’을 이용한 한 줄 전체 주석을 사용할 수 있습니다.</p>
<p><em>test.js</em><br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># style line comment -scripting mode</div><div class="line"># prints hello</div><div class="line"></div><div class="line">print('hello');</div></pre></td></tr></table></figure></p>
<h3 id="1-2-Shebang"><a href="#1-2-Shebang" class="headerlink" title="1.2 Shebang"></a>1.2 Shebang</h3><p>Shebang은 Unix 계열 shell script에서 script 해석 인터프리터를 명시한 것을 말합니다.<br>대부분의 Unix 계열 shell script의 첫번째 라인에 아래와 같은 부분이 있는데 이게 Shebang입니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#!/usr/bin/perl</div><div class="line">#!/bin/sh</div><div class="line">#!/usr/bin/php</div><div class="line">#!/usr/bin/ruby</div></pre></td></tr></table></figure>
<p>Nashorn은 Shebang 스크립팅을 지원합니다.<br>따라서 아래와 같이 기존 방식처럼 JavaScript 파일을 호출하는 대신</p>
<p><em>test.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">'hello'</span>);</div></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ jjs test.js</div></pre></td></tr></table></figure>
<p>첫 줄에 Shebang과 함께 다음과 같은 JavaScript 파일을 작성할 수 있습니다.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/jjs</span></div><div class="line">print(<span class="string">'hello'</span>);</div></pre></td></tr></table></figure></p>
<p>다른 shell 스크립트와 마찬가지로 실행 파일로 만들고 명령 행에서 실행할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ chmod 755 test.js</div><div class="line">$ ./test.js</div></pre></td></tr></table></figure>
<blockquote>
<p>이 장의 시작 부분에서 언급했듯이 <code>jjs</code>에 대한 링크가 있어야합니다.<br>Shebang Nashorn 스크립트를 실행하면 스크립팅 모드가 자동으로 활성화됩니다.</p>
</blockquote>
<h2 id="2-Java에서-Nashorn-JavaScript-엔진-사용"><a href="#2-Java에서-Nashorn-JavaScript-엔진-사용" class="headerlink" title="2. Java에서 Nashorn JavaScript 엔진 사용"></a>2. Java에서 Nashorn JavaScript 엔진 사용</h2><p>Nashorn 엔진은 JSR-223(Scripting for the Java Platform)의 자바 스크립트 구현이며 <em>javax.script</em> API의 구현체 입니다.<br>따라서 Java에서 JavaScript 코드를 사용하기 위해서는 Nashorn <em>javax.script.ScriptEngine</em>을 생성 해야 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ScriptEngine engine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">"nashorn"</span>); <span class="comment">//  --- (1)</span></div><div class="line">engine.eval(<span class="string">"print('Hello World');"</span>);</div></pre></td></tr></table></figure>
<blockquote>
<p>(1) 여기에서 사용할 수있는 Nashorn 엔진 이름은 <em>“nashorn”</em>, <em>“javascript”</em>및 <em>“js”</em>입니다.</p>
</blockquote>
<p>위에서 볼 수 있듯이 JavaScript 코드는 엔진 객체의 <em>eval()</em> 메서드에 문자열로 전달하여 직접 실행할 수 있습니다.<br>또는 파일을 가리키는 FileReader 객체를 전달하여 <code>.js</code> 파일을 구문 분석(및 실행)을 할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ScriptEngine engine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">"nashorn"</span>);</div><div class="line">engine.eval(<span class="keyword">new</span> FileReader(<span class="string">"test.js"</span>));</div></pre></td></tr></table></figure>
<h3 id="2-1-Java에서-JavaScript-함수-호출"><a href="#2-1-Java에서-JavaScript-함수-호출" class="headerlink" title="2.1. Java에서 JavaScript 함수 호출"></a>2.1. Java에서 JavaScript 함수 호출</h3><p>Java 프로그램 내부에서 단일 JavaScript 구문 또는 JavaScript 파일을 실행하거나 JavaScript 함수를 호출할 수도 있습니다.<br>또한 Java 객체를 JavaScript 함수의 arguments로 전달하고, JavaScript 함수에서 호출한 Java 메서드로 데이터를 반환할 수 있습니다.</p>
<p><em>example.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> sayHello = <span class="function"><span class="keyword">function</span>(<span class="params">name</span>) </span>&#123;</div><div class="line">  print(<span class="string">'Hello, '</span> + name + <span class="string">'!'</span>);</div><div class="line">  <span class="keyword">return</span> <span class="string">'hello from javascript'</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>위와 같이 작성된 example.js에 정의된 <em>sayHello</em> 함수를 호출하려면,<br>먼저 아래의 코드에서 보는 바와 같이 <em>engine</em> 객체를 <code>NashornScriptEngine</code>에서 구현된 <code>Invocable</code> Interface로 캐스팅해야합니다.<br><code>Invocable</code> Interface는 <em>invokeFunktion()</em> 메서드를 제공하는데, 이 메서드는 입력값으로 받은 JavaScript 함수이름과 arguments를 이용해 Javascript를 실행할수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ScriptEngine engine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">"nashorn"</span>);</div><div class="line">engine.eval(<span class="keyword">new</span> FileReader(<span class="string">"example.js"</span>));</div><div class="line"></div><div class="line"><span class="comment">// cast the script engine to an invocable instance</span></div><div class="line">Invocable invocable = (Invocable) engine;</div><div class="line"></div><div class="line">Object result = invocable.invokeFunction(<span class="string">"sayHello"</span>, <span class="string">"John Doe"</span>);</div><div class="line">System.out.println(result);</div><div class="line">System.out.println(result.getClass());</div><div class="line"></div><div class="line"><span class="comment">// Hello, John Doe!</span></div><div class="line"><span class="comment">// hello from javascript</span></div><div class="line"><span class="comment">// class java.lang.String</span></div></pre></td></tr></table></figure>
<p>위에 기술한 코드는 콘솔에 세 줄을 출력합니다.<br>JavaScript의 <em>sayHello</em> 함수의 <em>print()</em>는 <em>System.out</em>에 pipe되어 출력하고, Java 코드의 두개 <em>System.out.println()</em> 메소드에서 <em>sayHello</em> 함수의 리턴값과 리턴값의 Class이름을 출력합니다.</p>
<h3 id="2-2-Javascript에서-Java-method-호출"><a href="#2-2-Javascript에서-Java-method-호출" class="headerlink" title="2.2. Javascript에서 Java method 호출"></a>2.2. Javascript에서 Java method 호출</h3><p>JavaScript 코드에서 Java 메소드를 호출하거나 실행하는 반대의 경우도 간단합니다.<br>Java의 두 종류의 메소드를 가정해 보겠습니다.</p>
<p><em>MyJavaClass.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> my.<span class="keyword">package</span>;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJavaClass</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">sayHello</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> String.format(<span class="string">"Hello %s from Java!"</span>, name);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> a + b;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Java 클래스는 <em>Java.type</em> API 확장을 통해 JavaScript에서 참조할 수 있습니다.<br>이는 Java의 <code>import</code> 문과 유사합니다. Java 클래스를 참조한 후에 <em>sayhello()</em> 메서드와 같은 static method는 바로 호출하여 결과를 <em>System.out</em>에 출력할 수 있습니다. 또한 <em>add()</em>와 같은 일반 메서드들은 class의 인스턴스를 생성하여 호출할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> MyJavaClass = Java.type(<span class="string">'my.package.MyJavaClass'</span>);</div><div class="line"></div><div class="line"><span class="comment">// call the static method</span></div><div class="line"><span class="keyword">var</span> greetingResult = MyJavaClass.sayHello(<span class="string">'John Doe'</span>);</div><div class="line">print(greetingResult);</div><div class="line"></div><div class="line"><span class="comment">// create a new intance of MyJavaClass</span></div><div class="line"><span class="keyword">var</span> myClass = <span class="keyword">new</span> MyJavaClass();</div><div class="line"><span class="keyword">var</span> calcResult = myClass.add(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">print(calcResult);</div><div class="line"></div><div class="line"><span class="comment">// Hello John Doe from Java!</span></div><div class="line"><span class="comment">// 3</span></div></pre></td></tr></table></figure>
<h4 id="2-2-1-Nashorn의-type-변환"><a href="#2-2-1-Nashorn의-type-변환" class="headerlink" title="2.2.1. Nashorn의 type 변환"></a>2.2.1. Nashorn의 type 변환</h4><p>아래의 간단한 예제를 통해 JavaScript에서 Java 메서드를 호출할 때 Nashorn이 Java와 JavaScript 간의 형식 변환을 처리하는 방법을 확인할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printType</span><span class="params">(Object object)</span> </span>&#123;</div><div class="line">    System.out.println(object.getClass());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">MyJavaClass.printType(<span class="string">'Hello'</span>);</div><div class="line"><span class="comment">// class java.lang.String</span></div><div class="line"></div><div class="line">MyJavaClass.printType(<span class="number">123</span>);</div><div class="line"><span class="comment">// class java.lang.Integer</span></div><div class="line"></div><div class="line">MyJavaClass.printType(<span class="number">12.34</span>);</div><div class="line"><span class="comment">// class java.lang.Double</span></div><div class="line"></div><div class="line">MyJavaClass.printType(<span class="literal">true</span>);</div><div class="line"><span class="comment">// class java.lang.Boolean</span></div><div class="line"></div><div class="line">MyJavaClass.printType(<span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>));</div><div class="line"><span class="comment">// class jdk.nashorn.internal.objects.NativeNumber</span></div><div class="line"><span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span></div><div class="line"></div><div class="line">MyJavaClass.printType(<span class="keyword">new</span> <span class="built_in">Date</span>());</div><div class="line"><span class="comment">// class jdk.nashorn.internal.objects.NativeDate</span></div><div class="line"><span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span></div><div class="line"></div><div class="line">MyJavaClass.printType(<span class="keyword">new</span> <span class="built_in">RegExp</span>());</div><div class="line"><span class="comment">// class jdk.nashorn.internal.objects.NativeRegExp</span></div><div class="line"><span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span></div><div class="line"></div><div class="line">MyJavaClass.printType(&#123;<span class="attr">foo</span>: <span class="string">'bar'</span>&#125;);</div><div class="line"><span class="comment">// class jdk.nashorn.internal.scripts.J04</span></div><div class="line"><span class="comment">// class jdk.nashorn.api.scripting.ScriptObjectMirror</span></div></pre></td></tr></table></figure>
<ul>
<li>Primitive JavaScript type은 적절한 Java 래퍼 클래스로 변환됩니다.</li>
<li>Native JavaScript 객체는 <em>ScriptObjectMirror</em> 내부의 각각 어댑터 클래스로 표현됩니다.</li>
</ul>
<blockquote>
<p><em>jdk.nashorn.internal</em>의 클래스는 추후 변경 될 수 있으므로 클라이언트 코드에서 해당 클래스에 대해 프로그램을 작성하면 안됩니다.</p>
</blockquote>
<h3 id="2-3-ScriptObjectMirror"><a href="#2-3-ScriptObjectMirror" class="headerlink" title="2.3. ScriptObjectMirror"></a>2.3. ScriptObjectMirror</h3><p><em>ScriptObjectMirror</em>는 <em>jdk.nashorn.api</em>의 일부이며 기본 Javascript 내부 클래스 대신 Java 클라이언트 코드에서 사용하기위한 것입니다. 이 미러 객체는 JavaScript의 기본 객체의 표현입니다. 또한 Java Map 인터페이스를 구현하였으며, 객체, 메서드 및 속성에 대한 액세스를 제공합니다.</p>
<p>위의 예제를 조금 바꿔 보겠습니다.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public <span class="keyword">static</span> <span class="keyword">void</span> printObjectMirror(ScriptObjectMirror mirror) &#123;</div><div class="line">    System.out.println(mirror.getClassName() + <span class="string">": "</span> + Arrays.toString(mirror.getOwnKeys(<span class="literal">true</span>)));</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>마지막 네개의 JavaScript 함수 호출 (number, date, regexp 및 object literal)을 사용하여이 메서드를 호출하면 다음과 같습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">MyJavaClass.printObjectMirror(<span class="keyword">new</span> <span class="built_in">Number</span>(<span class="number">123</span>));</div><div class="line">MyJavaClass.printObjectMirror(<span class="keyword">new</span> <span class="built_in">Date</span>());</div><div class="line">MyJavaClass.printObjectMirror(<span class="keyword">new</span> <span class="built_in">RegExp</span>());</div><div class="line">MyJavaClass.printObjectMirror(&#123;</div><div class="line">    <span class="attr">foo</span>: <span class="string">'bar'</span>,</div><div class="line">    <span class="attr">bar</span>: <span class="string">'foo'</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>결과는 다음과 같습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Number: []</div><div class="line">Date: []</div><div class="line">RegExp: [lastIndex, <span class="built_in">source</span>, global, ignoreCase, multiline]</div><div class="line">Object: [foo, bar]</div></pre></td></tr></table></figure>
<p>또한 Java에서 JavaScript 객체의 멤버 함수를 호출할 수 있습니다.<br><code>firstName</code>, <code>lastName</code> 속성과 <em>getFullName()</em> 함수를 가진 JavaScript Person 타입을 가정해 보겠습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName, lastName</span>) </span>&#123;</div><div class="line">  <span class="keyword">this</span>.firstName = firstName;</div><div class="line">  <span class="keyword">this</span>.lastName = lastName;</div><div class="line">  <span class="keyword">this</span>.getFullName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">' '</span> + <span class="keyword">this</span>.lastName;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Javascript의 <em>getFullName()</em> 함수는 <em>ScriptObjectMirror</em> 클래스의 <em>callMember()</em> 메서드를 이용해 호출할수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getFullName</span><span class="params">(ScriptObjectMirror person)</span> </span>&#123;</div><div class="line">    System.out.println(<span class="string">"Full name is: "</span> + person.callMember(<span class="string">"getFullName"</span>));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>person 객체를 Java 메서드에 전달하면 콘솔에 원하는 결과가 표시됩니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> Person(<span class="string">'John'</span>, <span class="string">'Doe'</span>);</div><div class="line">MyJavaClass.getFullName(person);</div><div class="line"></div><div class="line"><span class="comment">// Full name is: John Doe</span></div></pre></td></tr></table></figure>
<h3 id="2-4-Script-engine-옵션"><a href="#2-4-Script-engine-옵션" class="headerlink" title="2.4. Script engine 옵션"></a>2.4. Script engine 옵션</h3><p><code>nashorn.args</code> system property을 사용하여 Nashorn 스크립트 엔진을 customize 할 수 있습니다. 예를 들어 아래와 같이 스트립팅 모드 사용옵션을 <code>-Dnashorn.args = ...</code>을 이용하여 지정할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ java -Dnashorn.args=-scripting MyJavaClass</div></pre></td></tr></table></figure>
<p>customize 옵션을 파라메터로 넘겨 Nashorn engine을 생성할 수도 있습니다. 이 경우 아래 예제와 같이 <em>NashornScriptEngineFactory</em>를 직접 인스턴스화 해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NashornScriptEngineFactory factory = <span class="keyword">new</span> NashornScriptEngineFactory();</div><div class="line">ScriptEngine engine = factory.getScriptEngine(<span class="keyword">new</span> String[] &#123; <span class="string">"-scripting"</span> &#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>jjs -help를 호출하여 사용 가능한 옵션을 확인할 수 있습니다.</p>
</blockquote>
<h3 id="2-5-Bindings-Context"><a href="#2-5-Bindings-Context" class="headerlink" title="2.5. Bindings / Context"></a>2.5. Bindings / Context</h3><p>ScriptContext는 하나 이상의 jsr223 “scope”이 Binding 되어 포함되어 있습니다. 그리고 디폴트 <code>scope</code>으로 <code>ENGINE_SCOPE</code>와 <code>GLOBAL_SCOPE</code>의 두 가지가 있습니다. </p>
<ul>
<li><code>ENGINE_SCOPE</code></li>
<li><code>GLOBAL_SCOPE</code></li>
</ul>
<p>Nashorn 엔진이 생성되고 default context를 생성합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ScriptContext defaultContext = engine.getContext();</div></pre></td></tr></table></figure>
<p><code>default context</code>의 <code>ENGINE_SCOPE</code>은 ECMAScript “global” object를 래핑한 인스턴스입니다. 이 object는 최상위 script의 “this”입니다. 따라서 이 <code>scope</code> 객체에서 “Object”, “Math”, “RegExp”, “undefined”와 같은 ECMAScript 최상위 객체를 액세스할 수 있습니다. 또한 <code>GLOBAL_SCOPE</code>은 같은 <em>ScriptEngineManager</em>로 작성된 모든 엔진 사이에 공유됩니다.<br><code>context</code>에 변수들을 저장할 수 있지만 scope은 선택 사항이며 기본값은 ENGINE_SCOPE입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ScriptContext context = engine.getContext();</div><div class="line"><span class="comment">// stores an object under the key `myKey` in the (engine scoped) context</span></div><div class="line">context.setAttribute(<span class="string">"myKey"</span>, object, ScriptContext.ENGINE_SCOPE);</div><div class="line"><span class="comment">// retrieves the object with key `myKey` from (engine scoped) context</span></div><div class="line">context.getAttribute(<span class="string">"myKey"</span>, ScriptContext.ENGINE_SCOPE);</div><div class="line"></div><div class="line">Bindings b = context.getBindings(ScriptContext.ENGINE_SCOPE);</div><div class="line">b.get(<span class="string">"Object"</span>);    <span class="comment">// gets ECMAScript "Object" constructor</span></div><div class="line">b.get(<span class="string">"undefined"</span>); <span class="comment">// ECMAScript 'undefined' value</span></div></pre></td></tr></table></figure>
<p>Nashorn이 변수를 검색할 때 <code>ENGINE_SCOPE</code>에 없으면 <code>GLOBAL_SCOPE</code> Binding에서 검색합니다.</p>
<blockquote>
<p>ECMAScript의 “<code>global</code>“ property가(최상위 레벨의 “this”) <code>GLOBAL_SCOPE</code>가 아닌 <code>ENGINE_SCOPE</code>에 있어 혼란이 있을 수 있습니다.</p>
<p>더 많은 Bindings와 ScriptContext정보는 <a href="https://wiki.openjdk.java.net/display/Nashorn/Nashorn+jsr223+engine+notes" target="_blank" rel="external">wiki</a>를 참고하세요.</p>
</blockquote>
<h2 id="3-API-and-Language-Extensions"><a href="#3-API-and-Language-Extensions" class="headerlink" title="3. API and Language Extensions"></a>3. API and Language Extensions</h2><p>Nashorn은 ECMAScript 표준 외에도 다양한 언어 및 API 확장 기능을 제공합니다. 대부분의 API 확장은 Rhino에 대한 호환성 때문에 발생합니다.</p>
<blockquote>
<p>Rhino는 mozilla에서 개발한 Java로 구현된 JavaScript engine이다.<br>과거 Netscape에서 Java로 구현된 navigator를 구현하려는 시도를 한 적이 있는데, 이때 사용했던 JavaScript engine이 Rhino engine의 전신이된다.<br>Javagator라고 불리던 이 프로젝트는 JavaScript를 Java byte code로 컴파일하여 실행하기 때문에 당시에 있던 다른 브라우저보다 빠른  성능을 낼 수 있을것으로 기대했지만, JVM 자체의 성능 이슈와 다른 여러가지 상황때문에 중간에 중단되었지만, 일부 회사들의 지원으로 JavaScript framework은 분리되어 Rhino가 되었다.</p>
<p>Rhino의 가장 큰 특징은 내부적으로 Reflection을 이용하여 JavaScript 코드에서 Java class를 그대로 가져다 쓸 수 있다는 것이다.<br>또한 Java구현체를 그대로 사용할 수 있기 때문에, JavaScript engine 중에서는 특이하게 multi thread support가 된다는 특징을 가진다.</p>
<p>JVM이 꾸준히 성장하여 많은 성능 개선을 이루었지만, WebKit이 사용하는 JSC(JavaScript Core)나 Google이 개발한 v8 engine도 내부적으로 JavaScript를 compile하기 때문에 Rhino가 가지는 성능상의 이점은 없다. 사실상 v8이나 jsc보다 느리다.</p>
<p>성능상에 이점은 없지만, 반드시 Java를 사용해야 하거나 multi-core support가 필요한 일부 환경에서는 Rhino engine을 사용하는 경우가 있다. 하지만 이 중에 이름만 들어서 알만한 유명한 프로젝트는 없다.<br>Rhino를 사용하는 가장 유명한 구현체는 RingoJS로 보인다.<br><a href="http://blog.seulgi.kim/2014/06/rhino-javascript-framework.html" target="_blank" rel="external">http://blog.seulgi.kim/2014/06/rhino-javascript-framework.html</a></p>
</blockquote>
<p>제가 생각하기에 흥미롭고 유횽한 기능들 위주로 살펴 보도록 하겠습니다.</p>
<h3 id="3-1-Print-Function"><a href="#3-1-Print-Function" class="headerlink" title="3.1. Print Function"></a>3.1. Print Function</h3><p>Nashorn은 <code>arguments</code>를 문자열로 변환 한 후 표준 출력(<code>stdout</code>)으로 출력하는 기능을 제공합니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">"Hello"</span>, <span class="string">"World"</span>);</div><div class="line"><span class="comment">// Hello World</span></div></pre></td></tr></table></figure>
<blockquote>
<p><code>echo()</code>함수는 <code>print()</code> 함수와 동일한 기능을 합니다.<br>Nashorn에는 브라우저에서 주로 로깅에 사용하는 <code>console</code> object를 가지고 있지 않습니다.</p>
</blockquote>
<h3 id="3-2-Stdin에서-읽기"><a href="#3-2-Stdin에서-읽기" class="headerlink" title="3.2. Stdin에서 읽기"></a>3.2. Stdin에서 읽기</h3><p><code>stdin</code>에서 읽으려는 경우 <code>readLine()</code> 함수를 사용할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">jjs&gt; <span class="keyword">var</span> name = readLine(<span class="string">"What is your name? "</span>)</div><div class="line">What is your name? John</div><div class="line">jjs&gt; print(<span class="string">"Hello, $&#123;name&#125;!"</span>)</div><div class="line">Hello, John!</div></pre></td></tr></table></figure>
<h3 id="3-3-Files에서-읽기"><a href="#3-3-Files에서-읽기" class="headerlink" title="3.3. Files에서 읽기"></a>3.3. Files에서 읽기</h3><p>stdin이 충분하지 않으면 <code>readFully()</code>를 사용하여 전체 파일 내용을 변수로 읽을 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> content = readFully(<span class="string">'text.txt'</span>);</div></pre></td></tr></table></figure>
<h3 id="3-4-문자열-Interpolation"><a href="#3-4-문자열-Interpolation" class="headerlink" title="3.4 문자열 Interpolation"></a>3.4 문자열 Interpolation</h3><p><code>${expression}</code> 구문을 사용하여 문자열 리터럴에 표현식을 지정할 수 있습니다. 문자열 값은 <code>${expression}</code> 표현식의 이름을 해당 변수의 값으로 대체하여 계산됩니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> name = <span class="string">"World"</span>;</div><div class="line"><span class="keyword">var</span> str = <span class="string">"Hello, $&#123;name&#125;!"</span>;</div><div class="line">print(str);</div><div class="line"><span class="comment">// Hello, World!</span></div></pre></td></tr></table></figure>
<h3 id="3-5-Back-quote-실행-표현식"><a href="#3-5-Back-quote-실행-표현식" class="headerlink" title="3.5 Back-quote 실행 표현식"></a>3.5 Back-quote 실행 표현식</h3><p>Nashorn은 <code>back quote</code>(역 따옴표) 문자열과 같은 유닉스 shell을 지원합니다. back quote로 묶인 문자열은 ‘exec’로 실행되고 리턴된 문자열을 프로그램에서 받을 수 있습니다.</p>
<p><em>test.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/jjs</span></div><div class="line"><span class="keyword">var</span> files = <span class="string">`ls -l`</span>;  <span class="comment">// get file listing as a string</span></div><div class="line"><span class="keyword">var</span> lines = files.split(<span class="string">"\n"</span>);</div><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> l <span class="keyword">in</span> lines) &#123;</div><div class="line">    <span class="keyword">var</span> line = lines[l];</div><div class="line">    print(line);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>이방법은 ES6의 새로운 역 따옴표 문자열 템플릿과 함께 사용하지 마십시오. 위에서 언급 한 문자열 Interpolation과 유사합니다!</p>
</blockquote>
<h3 id="3-6-Java-Beans"><a href="#3-6-Java-Beans" class="headerlink" title="3.6. Java Beans"></a>3.6. Java Beans</h3><p>Nashorn을 사용하면 Java bean의 <code>getter</code> 및 <code>setter</code>로 작업하는 대신 Java bean에서 값을 가져 오거나 설정하는 데 간단히 속성 이름을 사용할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> <span class="built_in">Date</span> = Java.type(<span class="string">'java.util.Date'</span>);</div><div class="line"><span class="keyword">var</span> date = <span class="keyword">new</span> <span class="built_in">Date</span>();</div><div class="line">date.year += <span class="number">1900</span>; <span class="comment">// -&gt; no setter!</span></div><div class="line">print(date.year);  <span class="comment">// -&gt; no getter!</span></div><div class="line"><span class="comment">// 2016</span></div></pre></td></tr></table></figure>
<h3 id="3-7-Function-Literals"><a href="#3-7-Function-Literals" class="headerlink" title="3.7. Function Literals"></a>3.7. Function Literals</h3><p>간단한 한 줄 함수의 경우, 반드시 중괄호를 사용할 필요는 없습니다 (또한 return 키워드도 생략할 수도 있습니다).</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sqr</span>(<span class="params">x</span>) <span class="title">x</span> * <span class="title">x</span>;</span></div><div class="line"><span class="title">print</span>(<span class="params">sqr(<span class="number">3</span></span>));    // 9</div><div class="line"></div><div class="line"><span class="title">function</span> <span class="title">add</span>(<span class="params">a, b</span>) <span class="title">a</span> + <span class="title">b</span>;</div><div class="line"><span class="title">print</span>(<span class="params">add(<span class="number">1</span>, <span class="number">2</span></span>));  // 3</div></pre></td></tr></table></figure>
<h3 id="3-8-Binding-Properties"><a href="#3-8-Binding-Properties" class="headerlink" title="3.8. Binding Properties"></a>3.8. Binding Properties</h3><p>두 개의 서로 다른 객체의 속성을 함께 바인딩할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/jjs</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> o1 = &#123;&#125;;</div><div class="line"><span class="keyword">var</span> o2 = &#123; <span class="attr">foo</span>: <span class="string">'bar'</span> &#125;;</div><div class="line"></div><div class="line"><span class="built_in">Object</span>.bindProperties(o1, o2);</div><div class="line"></div><div class="line">print(o1.foo);    <span class="comment">// bar</span></div><div class="line">o1.foo = <span class="string">'John'</span>;</div><div class="line">print(o2.foo);    <span class="comment">// John</span></div></pre></td></tr></table></figure>
<h3 id="3-9-Trimming-Strings"><a href="#3-9-Trimming-Strings" class="headerlink" title="3.9. Trimming Strings"></a>3.9. Trimming Strings</h3><p><code>trim()</code>뿐만 아니라 <code>trimLeft()</code>, <code>trimRight()</code>를 이용하여 문자열의 white space를 제거할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/jjs</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> bar = <span class="string">"   bar"</span>;</div><div class="line"><span class="keyword">var</span> foo = <span class="string">"foo   "</span>;</div><div class="line"></div><div class="line">print (<span class="string">"["</span> + bar.trim() +<span class="string">"]"</span>);                <span class="comment">// [bar]</span></div><div class="line">print (<span class="string">"["</span> + bar.trimLeft() + <span class="string">"]"</span>);           <span class="comment">// [bar]</span></div><div class="line">print (<span class="string">"["</span> + foo.trimRight() + <span class="string">"bar"</span> + <span class="string">"]"</span>);  <span class="comment">// [foobar]</span></div></pre></td></tr></table></figure>
<h3 id="3-10-Whereis"><a href="#3-10-Whereis" class="headerlink" title="3.10. Whereis"></a>3.10. Whereis</h3><p>만약 프로그램중에 현재의 위치를 알아야 할 경우 아래와 같이 사용할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print(__FILE__, __LINE__, __DIR__);</div></pre></td></tr></table></figure>
<h3 id="3-11-Import-Scopes"><a href="#3-11-Import-Scopes" class="headerlink" title="3.11. Import Scopes"></a>3.11. Import Scopes</h3><p>때로는 한 번에 많은 자바 패키지를 import 해야할 수도 있습니다. 그럴 경우 JavaImporter 클래스를 with 문과 함께 사용하여 import한 Java 패키지의 모든 클래스 파일을 with 문의 로컬 scope 내에서 액세스할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> imports = <span class="keyword">new</span> JavaImporter(java.io, java.lang);</div><div class="line"><span class="keyword">with</span> (imports) &#123;</div><div class="line">    <span class="keyword">var</span> file = <span class="keyword">new</span> File(__FILE__);</div><div class="line">    System.out.println(file.getAbsolutePath());  <span class="comment">// /path/to/my/script.js</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="3-12-Packages"><a href="#3-12-Packages" class="headerlink" title="3.12. Packages"></a>3.12. Packages</h3><p><code>Pacakges</code>및 연관된 객체들이 script내에서 Java 패키지에 대한 액세스를 지원합니다. <code>Packages</code> 변수의 속성은 모두 Java, javax와 같은 최상위 Java 패키지입니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Vector = Packages.java.util.Vector;</div><div class="line"></div><div class="line"><span class="comment">// but short-cuts defined for important package prefixes like</span></div><div class="line"><span class="comment">//    Packages.java, Packages.javax, Packages.com</span></div><div class="line"><span class="comment">//    Packages.edu, Packages.javafx, Packages.org</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> JFrame = javax.swing.JFrame;  <span class="comment">// javax == Packages.javax</span></div><div class="line"><span class="keyword">var</span> List = java.util.List;        <span class="comment">// java == Packages.java</span></div></pre></td></tr></table></figure>
<p>jjs에서 다음을 테스트 해보세요</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">jjs&gt; Packages.java</div><div class="line">[JavaPackage java]</div><div class="line">jjs&gt; java</div><div class="line">[JavaPackage java]</div><div class="line">jjs&gt; java.util.Vector</div><div class="line">[JavaClass java.util.Vector]</div><div class="line">jjs&gt; javax</div><div class="line">[JavaPackage javax]</div><div class="line">jjs&gt; javax.swing.JFrame</div><div class="line">[JavaClass javax.swing.JFrame]</div></pre></td></tr></table></figure>
<h3 id="3-13-Typed-Arrays"><a href="#3-13-Typed-Arrays" class="headerlink" title="3.13. Typed Arrays"></a>3.13. Typed Arrays</h3><p>Native JavaScript의 배열은 타입이 지정되지 않습니다. 하지만 Nashorn은 <a href="https://www.khronos.org/registry/typedarray/specs/latest/" target="_blank" rel="external">ECMAScript 2015 명세</a>에 지정된 유형화된 배열을 구현합니다.</p>
<p>예를 들어 아래와 같이 <code>int</code>형 타입을 가진 배열을 만들수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> IntArray = Java.type(<span class="string">'int[]'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> array = <span class="keyword">new</span> IntArray(<span class="number">3</span>);</div><div class="line">array[<span class="number">0</span>] = <span class="number">3</span>;</div><div class="line">array[<span class="number">1</span>] = <span class="number">2</span>;</div><div class="line">array[<span class="number">2</span>] = <span class="number">1</span>;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    array[<span class="number">3</span>] = <span class="number">0</span>;  <span class="comment">// would be possible in pure JS</span></div><div class="line">&#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    print(e.message);  <span class="comment">// Array index out of range: 3</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">array[<span class="number">0</span>] = <span class="string">'42'</span>;</div><div class="line">print(array[<span class="number">0</span>]);  <span class="comment">// 42</span></div><div class="line"></div><div class="line">array[<span class="number">0</span>] = <span class="string">'some wrong type'</span>;</div><div class="line">print(array[<span class="number">0</span>]);  <span class="comment">// 0</span></div><div class="line"></div><div class="line">array[<span class="number">0</span>] = <span class="string">'3.14'</span>;</div><div class="line">print(array[<span class="number">0</span>]);  <span class="comment">// 3</span></div></pre></td></tr></table></figure>
<p><code>int[]</code> 배열은, 실제의 <code>Java int</code> 배열과 같이 동작합니다. 또한 Nashorn은 정수가 아닌 값을 추가하려고 할 때 implicit 한 형변환을 수행합니다. 또한 가능한 경우 문자열은 자동으로 <code>int</code>로 변환됩니다.</p>
<h3 id="3-14-Collections-and-For-Each"><a href="#3-14-Collections-and-For-Each" class="headerlink" title="3.14. Collections and For-Each"></a>3.14. Collections and For-Each</h3><p>자바 스크립트에서의 배열 처리는 때때로 짜증날때가 있습니다. 이제 Javascript의 배열의 사용 대신 모든 자바 컬렉션을 사용할 수 있습니다. 먼저 Java.type을 통해 Java 유형을 정의한 다음 필요에 따라 새 인스턴스를 작성하십시오.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> ArrayList = Java.type(<span class="string">'java.util.ArrayList'</span>);</div><div class="line"><span class="keyword">var</span> list = <span class="keyword">new</span> ArrayList();</div><div class="line">list.add(<span class="string">'a'</span>);</div><div class="line">list.add(<span class="string">'b'</span>);</div><div class="line">list.add(<span class="string">'c'</span>);</div><div class="line"></div><div class="line"><span class="keyword">for</span> each (<span class="keyword">var</span> el <span class="keyword">in</span> list) print(el);  <span class="comment">// a, b, c</span></div></pre></td></tr></table></figure>
<p>컬렉션과 배열을 순회하는 Java의 <code>foreach</code>문처럼  <code>Nashorn</code>에는 <code>for each</code>문이 있습니다.<br>다음은 <code>HashMap</code>을 사용하는 다른 컬렉션의 <code>for each</code> 예제입니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> java.util.HashMap();</div><div class="line">map.put(<span class="string">'foo'</span>, <span class="string">'red'</span>);</div><div class="line">map.put(<span class="string">'bar'</span>, <span class="string">'green'</span>);</div><div class="line"></div><div class="line"><span class="keyword">for</span> each (<span class="keyword">var</span> e <span class="keyword">in</span> map.keySet()) print(e);  <span class="comment">// foo, bar</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> each (<span class="keyword">var</span> e <span class="keyword">in</span> map.values()) print(e);  <span class="comment">// red, green</span></div></pre></td></tr></table></figure>
<h3 id="3-15-Array-변환"><a href="#3-15-Array-변환" class="headerlink" title="3.15. Array 변환"></a>3.15. Array 변환</h3><p><code>java.util</code>, <code>java.lang</code>과 같은 일부 패키지는 <code>Java.type</code> 또는 <code>JavaImporter</code>를 사용하지 않고 직접 액세스할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> list = <span class="keyword">new</span> java.util.ArrayList();</div><div class="line">list.add(<span class="string">"s1"</span>);</div><div class="line">list.add(<span class="string">"s2"</span>);</div><div class="line">list.add(<span class="string">"s3"</span>);</div></pre></td></tr></table></figure>
<p>아래 코드는 Java List를 Native JavaScript Array로 변환합니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> jsArray = Java.from(list);</div><div class="line">print(jsArray);                                  <span class="comment">// s1,s2,s3</span></div><div class="line">print(<span class="built_in">Object</span>.prototype.toString.call(jsArray));  <span class="comment">// [object Array]</span></div></pre></td></tr></table></figure>
<p>그리고 그 반대의 경우는 아래와 같은 코드를 사용할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> javaArray = Java.to([<span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>], <span class="string">"int[]"</span>);</div></pre></td></tr></table></figure>
<h3 id="3-16-Lambdas-and-Streams"><a href="#3-16-Lambdas-and-Streams" class="headerlink" title="3.16. Lambdas and Streams"></a>3.16. Lambdas and Streams</h3><p>Java 8의 Lambda와 Streams을 Nashorn에서도 사용할 수 있습니다. 그리고<br>ECMAScript 5.1에는 Java 8 Lambda의 간단한 화살표 구문( <code>-&gt;</code> )이 없습니다. 하지만 Java 8 Lambda가 허용되는 곳에서는 함수 리터럴을 사용할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> list2 = <span class="keyword">new</span> java.util.ArrayList();</div><div class="line">list2.add(<span class="string">"ddd2"</span>);</div><div class="line">list2.add(<span class="string">"aaa2"</span>);</div><div class="line">list2.add(<span class="string">"bbb1"</span>);</div><div class="line">list2.add(<span class="string">"aaa1"</span>);</div><div class="line">list2.add(<span class="string">"bbb3"</span>);</div><div class="line">list2.add(<span class="string">"ccc"</span>);</div><div class="line">list2.add(<span class="string">"bbb2"</span>);</div><div class="line">list2.add(<span class="string">"ddd1"</span>);</div><div class="line"></div><div class="line">list2</div><div class="line">    .stream()</div><div class="line">    .filter(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> el.startsWith(<span class="string">"aaa"</span>);</div><div class="line">    &#125;)</div><div class="line">    .sorted()</div><div class="line">    .forEach(<span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</div><div class="line">        print(el);</div><div class="line">    &#125;);</div><div class="line">    <span class="comment">// aaa1, aaa2</span></div></pre></td></tr></table></figure>
<blockquote>
<p>Java 8 Lambda 또는 SAM (single-abstract-method) 유형이 필요한 곳에서는 ECMAScript 함수를 인수로 전달할 수 있습니다!</p>
</blockquote>
<h4 id="3-16-1-모든-람다식은-JavaScript-Function-입니다"><a href="#3-16-1-모든-람다식은-JavaScript-Function-입니다" class="headerlink" title="3.16.1. 모든 람다식은 JavaScript Function 입니다."></a>3.16.1. 모든 람다식은 JavaScript Function 입니다.</h4><p>람다 형식의 인스턴스인 모든 Java 객체는 JavaScript Function처럼 취급 될 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> JFunction = Java.type(<span class="string">'java.util.function.Function'</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> JFunction() &#123;</div><div class="line">   <span class="attr">apply</span>: <span class="function"><span class="keyword">function</span>(<span class="params">x</span>) </span>&#123; print(x * x) &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">print(<span class="keyword">typeof</span> obj); <span class="comment">// prints "function"</span></div><div class="line"></div><div class="line"><span class="comment">// 'calls' lambda as though it is a function</span></div><div class="line">obj(<span class="number">23</span>);</div></pre></td></tr></table></figure>
<h3 id="3-17-Extending-Classes"><a href="#3-17-Extending-Classes" class="headerlink" title="3.17. Extending Classes"></a>3.17. Extending Classes</h3><p>Java 타입은 Java.extend 함수를 사용하여 간단히 확장할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Runnable = Java.type(<span class="string">'java.lang.Runnable'</span>);</div><div class="line"><span class="keyword">var</span> Printer = Java.extend(Runnable, &#123;</div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        print(<span class="string">'printed from a separate thread'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="keyword">var</span> Thread = Java.type(<span class="string">'java.lang.Thread'</span>);</div><div class="line"><span class="keyword">new</span> Thread(<span class="keyword">new</span> Printer()).start();</div><div class="line"></div><div class="line"><span class="keyword">new</span> Thread(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    print(<span class="string">'printed from another thread'</span>);</div><div class="line">&#125;).start();</div><div class="line"></div><div class="line"><span class="comment">// printed from a separate thread</span></div><div class="line"><span class="comment">// printed from another thread</span></div></pre></td></tr></table></figure>
<blockquote>
<p>위 코드에서 보듯이 Nashorn에서는 멀티 스레드 코드도 가능합니다.</p>
</blockquote>
<h3 id="3-18-Calling-Super"><a href="#3-18-Calling-Super" class="headerlink" title="3.18. Calling Super"></a>3.18. Calling Super</h3><p>ECMAScript에 Java의 <code>super</code>에 해당하는 키워드가 없기 때문에 JavaScript에서는 오버라이드된 멤버를 액세스하는 것은 어렵습니다. 하지만 Nashorn에서는 가능 합니다.</p>
<p>먼저 Java 코드에서 super class를 정의합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SuperRunner</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"super run"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>다음으로 JavaScript로부터 SuperRunner를 오버라이드(override) 합니다.<br>새로운 Runner 인스턴스를 생성할때 확장된 Nashorn 구문을 사용하는데 주의하세요.<br>오버라이드 멤버 구문은 Java의 익명 객체를 이용하여 정의 합니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> SuperRunner = Java.type(<span class="string">'my.package.SuperRunner'</span>);</div><div class="line"><span class="keyword">var</span> Runner = Java.extend(SuperRunner);</div><div class="line"></div><div class="line"><span class="keyword">var</span> runner = <span class="keyword">new</span> Runner() &#123;</div><div class="line">    <span class="attr">run</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        Java.super(runner).run();</div><div class="line">        print(<span class="string">'local run'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">runner.run();</div><div class="line"></div><div class="line"><span class="comment">// super run</span></div><div class="line"><span class="comment">// local run</span></div></pre></td></tr></table></figure>
<p>Java.super 확장을 활용하여 재정의된 메소드 SuperRunner.run ()을 호출합니다.</p>
<h3 id="3-19-Loading-Scripts"><a href="#3-19-Loading-Scripts" class="headerlink" title="3.19. Loading Scripts"></a>3.19. Loading Scripts</h3><p>JavaScript에서 추가 스크립트 파일을 실행 하는 것은 매우 쉽습니다. load 함수를 사용하여 로컬 또는 원격 스크립트를 로드할 수 있습니다.</p>
<p>아래의 예제는 moment.js와 Underscore.js를 로드해서 사용하는 예제입니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">load(<span class="string">'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.1/moment.min.js'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> now = <span class="keyword">new</span> moment();</div><div class="line">print(now);</div><div class="line"><span class="comment">// Thu Dec 31 2015 23:59:59 GMT+0100</span></div></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">oad(<span class="string">'http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> odds = _.filter([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], <span class="function"><span class="keyword">function</span> (<span class="params">num</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> num % <span class="number">2</span> == <span class="number">1</span>;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">print(odds);  <span class="comment">// 1, 3, 5</span></div></pre></td></tr></table></figure>
<p>외부 스크립트는 동일한 <code>JavaScript context</code>에서 evaluate 되므로 moment, Underscore를 직접 액세스할 수 있습니다.</p>
<h4 id="3-19-1-Load-in-new-Global-Context"><a href="#3-19-1-Load-in-new-Global-Context" class="headerlink" title="3.19.1. Load in new Global Context"></a>3.19.1. Load in new Global Context</h4><p>외부 파일을 로드할 때 로드된 코드에 자신의 코드에 있는 동일한 변수 이름이 사용될 수 있습니다. 이를 방지하기 위해 파일을 새로운 <code>global context</code>으로 로드할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">loadWithNewGlobal(<span class="string">'script.js'</span>);</div></pre></td></tr></table></figure>
<p>위와 같이 로드된 스크립트는 Nashorn <code>glogal context</code> (현재 <code>engine context</code>가 아님)에서만 사용할 수 있습니다.</p>
<h3 id="3-20-Error-Object"><a href="#3-20-Error-Object" class="headerlink" title="3.20. Error Object"></a>3.20. Error Object</h3><p>Nashorn은 ECMAScript의 표준 Error 객체에 몇 가지 흥미로운 속성을 추가 하여 확장했습니다.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">f</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    func();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    f();</div><div class="line">&#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    print(e.stack);</div><div class="line">    print(e.lineNumber);</div><div class="line">    print(e.columnNumber);</div><div class="line">    print(e.fileName);</div><div class="line"></div><div class="line">    <span class="comment">// of course, also this is possible</span></div><div class="line">    e.printStackTrace();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="3-21-Scripting-Mode-Extension-Objects"><a href="#3-21-Scripting-Mode-Extension-Objects" class="headerlink" title="3.21. Scripting Mode Extension Objects"></a>3.21. Scripting Mode Extension Objects</h3><p>Nashorn에는 <code>-scripting</code> 모드로 실행 되었을때 사용할 수 있는 몇몇 global 객체가 정의되어 있습니다.<br>대부분은 바로 알수 있는 부분이라 아래의 소스 코드를 참고하길 바랍니다.</p>
<h4 id="3-21-1-ARG"><a href="#3-21-1-ARG" class="headerlink" title="3.21.1. $ARG"></a>3.21.1. $ARG</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ jjs -scripting -- arg1 arg2 arg3</div><div class="line">jjs&gt; $ARG</div><div class="line">arg1,arg2,arg3</div><div class="line">jjs&gt; $ARG[<span class="number">1</span>]</div><div class="line">arg2</div></pre></td></tr></table></figure>
<p><strong>arguments</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ jjs -scripting -- arg1 arg2 arg3</div><div class="line">jjs&gt; <span class="built_in">arguments</span></div><div class="line">arg1,arg2,arg3</div><div class="line">jjs&gt; <span class="built_in">arguments</span>[<span class="number">1</span>]</div><div class="line">arg2</div><div class="line"><span class="string">`</span></div></pre></td></tr></table></figure></p>
<h4 id="3-21-2-ENV"><a href="#3-21-2-ENV" class="headerlink" title="3.21.2. $ENV"></a>3.21.2. $ENV</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// print $JAVA_HOME and $PATH from the OS shell</span></div><div class="line">print($ENV[<span class="string">"JAVA_HOME"</span>])</div><div class="line">print($ENV[<span class="string">"PATH"</span>])</div><div class="line">print($ENV.JAVA_HOME)</div><div class="line">print($ENV.PATH)</div></pre></td></tr></table></figure>
<h4 id="3-21-3-EXEC"><a href="#3-21-3-EXEC" class="headerlink" title="3.21.3. $EXEC"></a>3.21.3. $EXEC</h4><p>Shell 명령어 수행을 위한 프로세스 실행</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">jjs&gt; $EXEC(<span class="string">"ls -l"</span>)</div><div class="line">total <span class="number">0</span></div><div class="line">drwxr-xr-x+ <span class="number">1</span> johndoe staff <span class="number">4096</span> Dec <span class="number">31</span> <span class="number">12</span>:<span class="number">34</span> dir</div><div class="line">-rwxrw-r--  <span class="number">1</span> johndoe staff  <span class="number">168</span> Dec <span class="number">31</span> <span class="number">13</span>:<span class="number">37</span> file.txt</div><div class="line"></div><div class="line">jjs&gt; $EXEC(<span class="string">"cat"</span>, <span class="string">"Send this to stdout"</span>)</div><div class="line">Send <span class="keyword">this</span> to stdout</div></pre></td></tr></table></figure>
<h4 id="3-21-4-OUT"><a href="#3-21-4-OUT" class="headerlink" title="3.21.4. $OUT"></a>3.21.4. $OUT</h4><p><code>$OUT</code> 변수는 가장 최근에 <code>$EXEC</code>로 실행된 프로세스의 <code>stdout</code> 출력이 저장됩니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// use curl to download JSON weather data from the net</span></div><div class="line"><span class="keyword">var</span> str = <span class="string">`curl http://api.openweathermap.org/data/2.5/weather?q=Hamburg,de&amp;units=metric&amp;appid=44db6a862fba0b067b1930da0d769e98`</span>;</div><div class="line"></div><div class="line"><span class="comment">// parse JSON and print the current temperature</span></div><div class="line"><span class="keyword">var</span> weather = <span class="built_in">JSON</span>.parse($OUT);</div><div class="line">print(weather.main.temp);</div></pre></td></tr></table></figure>
<h4 id="3-21-5-ERR"><a href="#3-21-5-ERR" class="headerlink" title="3.21.5. $ERR"></a>3.21.5. $ERR</h4><p><code>$ERR</code> 변수는 가장 최근에 <code>$EXEC</code>로 실행된 프로세스의 <code>stderr</code> 출력이 저장됩니다.</p>
<h4 id="3-21-6-EXIT"><a href="#3-21-6-EXIT" class="headerlink" title="3.21.6. $EXIT"></a>3.21.6. $EXIT</h4><p><code>$EXIT</code> 변수는 <code>$EXEC</code>로 실행된 프로세스의 종료 코드가 저장됩니다.</p>
<h4 id="3-21-7-OPTIONS"><a href="#3-21-7-OPTIONS" class="headerlink" title="3.21.7. $OPTIONS"></a>3.21.7. $OPTIONS</h4><p>이 속성은 Nashorn CLI의 실행 옵션을 제공합니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">print(<span class="string">"-scripting = "</span> + $OPTIONS._scripting);         <span class="comment">// -scripting = true</span></div><div class="line">print(<span class="string">"--compile-only = "</span> + $OPTIONS._compile_only);  <span class="comment">// --compile-only = false</span></div><div class="line">print(<span class="string">"-timezone = "</span> + $OPTIONS._timezone.ID);        <span class="comment">// -timezone = Europe/Berlin</span></div></pre></td></tr></table></figure>
<blockquote>
<p>Nashorn이 구현한 다양한 언어 및 API 확장에 대한 설명은 <a href="https://wiki.openjdk.java.net/display/Nashorn/Nashorn+extensions" target="_blank" rel="external">Wiki</a> 페이지에서 확인할 수 있습니다.</p>
</blockquote>
<h2 id="4-Working-with-Package-Managers-amp-Repositories"><a href="#4-Working-with-Package-Managers-amp-Repositories" class="headerlink" title="4. Working with Package Managers &amp; Repositories"></a>4. Working with Package Managers &amp; Repositories</h2><p><code>Nashorn</code>으로 작업할 때, 처음부터 모든 기능을 개발하고 싶지는 않을 것입니다. 다행이도 <code>Maven</code>의 의존성 라이브러리를 사용하는 것처럼 이미 필요한 기능을 제공하는 <code>Nashorn</code> 라이브러리를 사용할 수 있습니다. 게다가 Java, JavaScript와 완벽히 호환되는 다양한 Repository와 Package Manager를 선택할 수도 있습니다.</p>
<h3 id="4-1-NPM"><a href="#4-1-NPM" class="headerlink" title="4.1. NPM"></a>4.1. NPM</h3><p><strong>N</strong>ode <strong>P</strong>ackage <strong>M</strong>anager - <a href="https://npmjs.org" target="_blank" rel="external">https://npmjs.org</a></p>
<p>npm은 Node.js의 Package Manager이고 개발자들이 JavaScript 애플리케이션에서 파일, 메타데이터, 의존성을 쉽게 관리하도록 만들어졌습니다. 2009년 오픈 소스 프로젝트로 시작된 npm은 개발자들이 인터넷을 통한 서비스로 오픈 소스 코드를 관리할 수 있도록 패키지 저장소 기능을 제공합니다. (<a href="https://nodejs.github.io/nodejs-ko/articles/2015/06/17/npm-is-massive/" target="_blank" rel="external">https://nodejs.github.io/nodejs-ko/articles/2015/06/17/npm-is-massive/</a>)</p>
<ul>
<li>NPM은 JavaScript의 server-side 프로그램인 Node.js 패키지 관리 프로그램입니다.</li>
<li>NPM Repository는 오픈 소스코드의 공개 컬랙션입니다.</li>
<li>또한 NPM은 Command line 클라이언트 입니다.</li>
</ul>
<p><code>Nashorn</code> 내에서 NPM 패키지를 사용할 수 있습니다!. 하지만 …</p>
<h4 id="4-1-1-JVM-NPM"><a href="#4-1-1-JVM-NPM" class="headerlink" title="4.1.1. JVM-NPM"></a>4.1.1. JVM-NPM</h4><p>대부분의 많은 JavaScript 패키지는 <a href="http://www.commonjs.org/" target="_blank" rel="external"><code>CommonJS</code></a>의 <code>require()</code>문 (Java에서 <code>import</code>와 같은)을 사용합니다. 하지만 불행이도 <code>Nashorn</code>은 JavaScript 엔진일 뿐이고 Package Manager 및 dependency loading 매커니즘을 지원하지 않습니다.</p>
<p>하지만 다행이도 <a href="https://github.com/nodyn/jvm-npm" target="_blank" rel="external"><code>npm-jvm</code></a>(JVM 용 NPM 호환 <code>CommonJS</code> 모듈 로더) 프로젝트가 있습니다. 이 모듈은 <code>Nashorn</code> script context에서 <code>require()</code> 함수를 사용할 수 있도록 합니다.  <code>Nashorn</code> script context에서 <code>CommonJS</code>에 의존성이 있는 패키지를 사용하려 할 때 <code>require()</code> 함수를 사용하여 다른 모듈을 로드할 수 있습니다.</p>
<p><strong>Usage</strong><br>Nashorn이 제공하는 global <code>load()</code> 함수를 사용하여 jvm-npm.js를 global execution context에 로드합니다. 그런 다음 <code>require()</code>를 사용하여 원하는 모듈을 로드할 수 있습니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nashorn&gt; load(<span class="string">'./jvm-npm.js'</span>);</div><div class="line">nashorn&gt; <span class="keyword">var</span> x = <span class="built_in">require</span>(<span class="string">'some_module'</span>);</div></pre></td></tr></table></figure>
<p>또는 비슷한 역할을 하는 <a href="https://github.com/walterhiggins/commonjs-modules-javax-script" target="_blank" rel="external"><code>commonjs-modules-javax-script</code></a> 프로젝트도 있습니다.</p>
<h4 id="4-1-2-Polyfill-js"><a href="#4-1-2-Polyfill-js" class="headerlink" title="4.1.2. Polyfill.js"></a>4.1.2. Polyfill.js</h4><p>NPM에 등록된 많은 라이브러리는 Node.js 또는 브라우저 공통 API를 사용합니다. Nashorn은 Node.js도 브라우저도 아니기 때문에 라이브러리에서 사용하는 Node.js 또는 브라우저의 공통 API를 정의 하여야 합니다. 이러한 부분을 보통 <em>polyfill</em>이라 부르고 사용할 수없는 환경에서 필요한 기능을 제공하기 위해 사용합니다.</p>
<p><em>nashorn-polyfill.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> global = <span class="keyword">this</span>;       <span class="comment">// ---(1)</span></div><div class="line"><span class="keyword">var</span> <span class="built_in">window</span> = <span class="keyword">this</span>;       <span class="comment">// ---(2)</span></div><div class="line"><span class="keyword">var</span> process = &#123;<span class="attr">env</span>:&#123;&#125;&#125;;  <span class="comment">// ---(3)</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> <span class="built_in">console</span> = &#123;&#125;;        <span class="comment">// ---(4)</span></div><div class="line"><span class="built_in">console</span>.debug = print;</div><div class="line"><span class="built_in">console</span>.log = print;</div><div class="line"><span class="built_in">console</span>.warn = print;</div><div class="line"><span class="built_in">console</span>.error = print;</div></pre></td></tr></table></figure></p>
<p>(1) Node.js에 있는 <code>global</code> variable을 위해 제공 (global context)<br>(2) 브라우저에 있는 <code>window</code> variable을 위해 제공 (global context)<br>(3) 몇몇 라이브러리에서 사용하는 Node.js의 <code>process.env</code> variable을 위해 제공<br>(4) Nashorn에는 <code>console</code>이 없기 때문에 가장 많이 사용되는 콘솔 출력 함수들을 print 함수에 할당합니다.</p>
<h4 id="4-1-3-Native-API-access"><a href="#4-1-3-Native-API-access" class="headerlink" title="4.1.3. Native API access"></a>4.1.3. Native API access</h4><p>Nashorn은 Native API (C/C++)를 액세스할 수 없습니다. 그래서 Native API를 사용하는 NPM 패키지는 Nashorn에서 사용할 수 없습니다.</p>
<h3 id="4-2-Maven"><a href="#4-2-Maven" class="headerlink" title="4.2. Maven"></a>4.2. Maven</h3><p>Java 프로젝트 내에서 Nashorn을 사용할 때 대부분의 경우 Maven을 저장소 및 패키지 관리자로 사용합니다. 몇가지 plugin과 helper를 이용하면 문제 없이 사용할 수 있습니다.</p>
<h4 id="4-2-1-Maven-and-NPM-Grunt-Gulp-etc"><a href="#4-2-1-Maven-and-NPM-Grunt-Gulp-etc" class="headerlink" title="4.2.1. Maven and NPM, Grunt, Gulp, etc."></a>4.2.1. Maven and NPM, Grunt, Gulp, etc.</h4><p>Node.js ecosystem, NPM 그리고 프론트 엔드 빌드 도구인 Grunt, Gulp, Webpack등과 같이 사용하고 싶다면 아래의 편리한 Maven plugin을 사용할 수 있습니다.</p>
<p><a href="https://github.com/eirslett/frontend-maven-plugin/" target="_blank" rel="external">https://github.com/eirslett/frontend-maven-plugin/</a> (이 plugin에 대한 자세한 설명과 문서는 Github 페이지를 참고하세요.)</p>
<h4 id="4-2-2-WebJars"><a href="#4-2-2-WebJars" class="headerlink" title="4.2.2. WebJars"></a>4.2.2. WebJars</h4><p>가장 많이 사용되고 인기 있는 NPM 패키지는 <a href="http://www.webjars.org" target="_blank" rel="external"><code>WebJars</code></a>에서 제공하고 있습니다. <code>WebJars</code>를 사용하면 NPM 패키지를 프로젝트에서 Maven dependency를 이용하여 사용할 수 있습니다.</p>
<p>아래는 <a href="http://momentjs.com" target="_blank" rel="external"><code>Moment.js</code></a>를 Maven에서 사용하는 예제입니다.</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars.npm<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>moment<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>만약 사용할수 있는 NPM 패키지가 Webjar에 없다면 웹 페이지에 있는 <a href="http://www.webjars.org/contributing" target="_blank" rel="external">자세히 설명된 문서</a>를 이용하여 쉽게 추가할 수 있습니다.</p>
<h3 id="4-2-3-Nasven"><a href="#4-2-3-Nasven" class="headerlink" title="4.2.3. Nasven"></a>4.2.3. Nasven</h3><p><a href="https://github.com/nasven/" target="_blank" rel="external">Nasven.js</a>는 Maven을 이용하여 아티팩트의 dependency를 관리하는 JavaScript 애플리케이션(서버, 데스크탑 및 쉘 스크립트)의 런타임입니다.</p>
<p>개발자는 순수한 서버 측 응용 프로그램, 쉘 스크립트 또는 JavaFX 데스크탑 응용 프로그램을 만들 수 있으며 Maven dependency는 클래스 경로에 자동으로 다운로드되고 구성됩니다.</p>
<p><em><strong>Nasven = Nashorn + Maven.</strong></em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$ nasven package.json</div><div class="line">nashorn full version 1.8.0_72-b15</div><div class="line">[NASVEN] Building temporary Apache Maven project to find dependencies ...</div><div class="line">[NASVEN] Done!</div><div class="line">[NASVEN] About to run your nasven.js application under /Users/Niko/nasven/nasven-samples/camel/index.js ...</div><div class="line"></div><div class="line">[NASVEN] Calling jjs <span class="keyword">for</span> your application ...</div></pre></td></tr></table></figure>
<p><strong>예제</strong></p>
<ul>
<li><a href="https://github.com/nasven/samples/tree/master/jaxrs" target="_blank" rel="external">JAX-RS</a></li>
<li><a href="https://github.com/nasven/samples/tree/master/camel" target="_blank" rel="external">Apache Camel</a></li>
</ul>
<h2 id="5-Isomorphic-JavaScript"><a href="#5-Isomorphic-JavaScript" class="headerlink" title="5. Isomorphic JavaScript"></a>5. Isomorphic JavaScript</h2><h3 id="5-1-Isomorphic의-뜻-그리고-무엇을-할-수-있고-왜-사용해야-하는가"><a href="#5-1-Isomorphic의-뜻-그리고-무엇을-할-수-있고-왜-사용해야-하는가" class="headerlink" title="5.1 Isomorphic의 뜻, 그리고 무엇을 할 수 있고 왜 사용해야 하는가?"></a>5.1 Isomorphic의 뜻, 그리고 무엇을 할 수 있고 왜 사용해야 하는가?</h3><p><code>Isomorphic</code>은 그리스어의 “isos”에서 “equal”의 의미를 , “morph”는 “shape”의 의미가 유래 되었습니다. 그래서, 동일하거나 동등한 형태의 뜻을 나타냅니다.</p>
<p><em>Isomorphism은  <code>동일한 엔티티</code>(1)에 대해 <code>두개의 서로 다른 context</code>(2) 에서 <code>같은 결과</code>(3)를 내야 한다고 설명합니다.(<a href="http://isomorphic.net/javascript" target="_blank" rel="external">http://isomorphic.net/javascript</a>)</em></p>
<ol>
<li>code</li>
<li>client and server</li>
<li>result, html, DOM, etc.</li>
</ol>
<p>우리의 경우에는 <em>“우리가 클라이언트와 서버에서 같은 JavaScript 코드를 사용한다면 우리는 같은 결과/html을 얻어야한다.”</em>입니다.</p>
<p><img src="http://www.n-k.de/riding-the-nashorn/images/isomorphic.png" alt="이미지"></p>
<h4 id="5-1-1-Isomorphic-code"><a href="#5-1-1-Isomorphic-code" class="headerlink" title="5.1.1. Isomorphic code"></a>5.1.1. Isomorphic code</h4><p>Isomorphic 코드는 클라이언트와 서버 측에서 동일한 로직을 공유할 수 있으므로 DRY 원칙 (Don’t Repeat Yourself)을 활용한 코드 작성이 가능합니다. 애플리케이션 로직은 한번 개발되고 하나의 코드베이스에서만 유지 하면됩니다. 만약 오류가 발생하는 경우 코드의 수정은 한곳에서만 진행하면 됩니다. 그리고 Isomorphic 코드로 인해 개발자가 하나의 기술에만 집중할 수 있으므로 여러 프로그래밍 언어에 대한 전문가가 될 필요는 없습니다.</p>
<p><strong>Example</strong></p>
<p>아래의 예제는 브라우저에서 사용하기 위해 JavaScript로 개발 한 패스워드 검증 코드입니다.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isPasswordValid</span>(<span class="params">password</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> score = scorePasswordStrength(password);</div><div class="line">    <span class="keyword">return</span> score &gt;= <span class="number">3</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>위 코드는 잘 작동하지만 만약 사용자가 브라우저에서 JavaScript를 사용하지 못하도록하고, 잘못된 암호를 서버에 전달하는 경우를 대비해, 서버(Java)에서 사용되는 프로그래밍 언어로 동일한 로직을 다시 개발해야합니다.<br>이것은 추가적인 노력이며, 구현할때 오류로 이어질 수 있고, 최근 변경된 로직에 대한 부분을 잊어 버리고 미구현할 수 있습니다.<br>Java 코드에서 JavaScript 코드 로직을 다시 사용하지 않을 이유가 있을까요? 아래 예제가 그 해법을 제시합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Boolean <span class="title">isPasswordValid</span><span class="params">(String password)</span> </span>&#123;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        <span class="keyword">return</span> (Boolean) nashorn.invokeFunction(<span class="string">"isPasswordValid"</span>, password);</div><div class="line">    &#125; <span class="keyword">catch</span> (ScriptException | NoSuchMethodException e) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="5-1-2-SPAs"><a href="#5-1-2-SPAs" class="headerlink" title="5.1.2. SPAs"></a>5.1.2. SPAs</h4><p>현재 대부분의 SPA(Single Page Web Application)는 HTML 스켈레톤과 UI 렌더링, transition 관리, path routing, 네비게이션, 로직등을 하나 이상의 JavaScript 라이브러리에서 처리 합니다.</p>
<p><em>index.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Awesome Website<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./app-bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>이러한 응용 프로그램은 대단히 훌륭하지만 몇 가지 단점이 있습니다.</p>
<p><strong>단점</strong></p>
<ol>
<li><strong>UX/Performance</strong> - 전체 스크립트 코드가 클라이언트(브라우저)에서 로드, 평가 및 실행되기 전까지 사용자는 아무 것도 볼 수 없습니다.</li>
</ol>
<ul>
<li>인터넷 연결 속도가 빠름에도 불구하고 Long wait time</li>
<li>사용자가 떠날 가능성이 있음 (3초 룰)</li>
<li>느린 인터넷 연결을 생각해 보십시오!</li>
</ul>
<ol>
<li><strong>Legacy Browser</strong>(아직 많이 사용하고 있습니다.)에서는 새로운 자바 스크립트를 실행시킬수 없습니다.</li>
<li><p><strong>SEO</strong> - 컨텐츠가 없기 때문에 검색엔진에서 여러분의 웹사이트를 인덱스할 수 없습니다.</p>
<ul>
<li>Google이 웹 사이트에서 JavaScript를 실행(evaluate)할 수 있다고 해도 여전히 오류가 발생하기 쉽습니다.</li>
</ul>
</li>
</ol>
<p>위와 같은 이유로 웹 페이지를 서버에 렌더링하는 것이 더 좋을수 있습니다.</p>
<p><strong>장점</strong></p>
<p>하지만 이건 어떨까요?</p>
<ul>
<li><strong>UX</strong> - 멋진 화면 전환 효과 (다른 동종의 사이트들과 경쟁할 수 있어야 합니다.)</li>
<li><strong>Performance</strong> - 페이지의 일부분만 빠르게 렌더링</li>
<li><strong>Performance</strong> - 전체 HTML 대신 필요한 데이터만 전송</li>
</ul>
<p>이러한 장점들은 클라이언트에서 프로그램을 실행하고 페이지를 렌더링할 때만 얻을 수 있습니다!</p>
<p><strong>해결방법</strong></p>
<ol>
<li>사용자가 처음 URL을 요청합니다.</li>
<li>서버가 해당 URL의 콘텐츠를 가져옵니다.</li>
<li>서버에서 콘텐츠를 응답 형태로 렌더링합니다.</li>
<li>사용자는 콘텐츠를 봅니다.</li>
<li>그 동안에 클라이언트가 초기화됩니다.</li>
<li>사용자가 다른 URL로 이동합니다.</li>
<li>클라이언트가 해당 URL의 콘텐츠를 가져옵니다.</li>
<li>클라이언트가 DOM에 내용을 렌더링합니다.</li>
</ol>
<p>사용자가 앱 또는 앱 경로에 대한 초기 요청할 때 페이지를 서버에서 렌더링하여 클라이언트에게 전송합니다.<br>그 순간부터 클라이언트는 콘텐트를 제어하고 콘텐트 렌더링을 계속할 수 있습니다.<br>이렇게하면 사용자가 초기 서버 측 렌더링 페이지를 사용하는 동안 클라이언트를 초기화하는 시간이 줄어듭니다.<br>그리고 검색 엔진에서 사이트의 인덱스를 생성하는 경우 이미 렌더링된 콘텐츠의 유효한 HTML을 서버에서 가져올수 있습니다.<br>그리고 기존 브라우저는 클라이언트가 페이지를 렌더링할 수 없는 경우에도 사이트를 사용할 수 있습니다.</p>
<h3 id="5-2-React-js"><a href="#5-2-React-js" class="headerlink" title="5.2. React.js"></a>5.2. React.js</h3><p><a href="https://facebook.github.io/react/" target="_blank" rel="external">React.js</a>는 Facebook에서 개발 한 사용자 인터페이스를 구현한 JavaScript 라이브러리입니다. 앱을 빌드하기 위한 전체 스택 클라이언트 프레임 워크가 아닙니다. MVC 또는 MVVM에서 React.js는 V(iew) 부분을 컴포넌트로 만들기 위한 라이브러리입니다.</p>
<p>React.js는 컴포넌트 기반 가상 DOM을 가지고 있습니다. 이 가상 DOM과 비교후 다른 부분을 적용하여 깜박임없이 페이지 전환 또는 콘텐츠 업데이트가 가능합니다. 또한 React는 템플릿의 서버 측 렌더링을 지원합니다.</p>
<h4 id="5-2-1-Flux"><a href="#5-2-1-Flux" class="headerlink" title="5.2.1. Flux"></a>5.2.1. Flux</h4><p>React를 이용하여 full-stack 애플리케이션을 구현하는 방법중에 <code>Flux</code>라는 아키텍처 방식이 있습니다.<br>이 아키텍처에는 직접 접근으로 변경할 수없는 <code>Immutable Entity</code> 및 <code>collection</code>이 있습니다. 응용 프로그램의 상태는 <code>Store</code>에 저장되고, 이 <code>Store</code>는 템플릿을 렌더링하기위한 데이터들이 저장됩니다. 또한 <code>Store</code>는 <code>Action</code>의 <code>Event</code>(데이터 포함)를 받은<br>Dispatcher만 수정할 수 있습니다. Action만이 Store가 외부 세계와 소통할 수있는 유일한 방법입니다.</p>
<p><img src="http://www.n-k.de/riding-the-nashorn/images/flux.png" alt=""></p>
<p>현재 가장 널리 사용되는 Flux 구현 라이브러리는 <a href="http://redux.js.org/" target="_blank" rel="external">Redux</a>가 있고 다른 많은 라이브러리도 있습니다.</p>
<h4 id="5-2-2-JSX"><a href="#5-2-2-JSX" class="headerlink" title="5.2.2. JSX"></a>5.2.2. JSX</h4><p>React.js는 JavaScript의 새로은 변형인 JSX를 HTML 요소와 혼합하여 많이 사용합니다. 아마도 처음에는 조금 어색할수 있지만 더 많이 사용하면 편리하다는 것을 느끼게 됩니다.</p>
<p><em>app.jsx</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</div><div class="line">    render() &#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"book"</span>&gt;</span></span></div><div class="line">                <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;this.props.author&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"lead"</span>&gt;</span>&#123;this.props.children.toString()&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><em>(위의 코드를 볼때 몇몇분들은 JSP가 생각날 수도 있습니다….)</em></p>
<p>JSX는 <a href="https://babeljs.io/" target="_blank" rel="external">Babel.js</a>를 사용하여 실행 가능한 JavaScript (ES5)로 변환 됩니다. (이전에는 Facebook의 라이브러리 인 JSXTransformer에서이 작업을 수행했지만 더 강력한 Babel로 바뀌었습니다.)</p>
<p><em>app.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> Book = React.createClass(&#123;<span class="attr">displayName</span>: <span class="string">"Book"</span>,</div><div class="line">    <span class="attr">render</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">        <span class="keyword">return</span> (</div><div class="line">            React.createElement(<span class="string">"div"</span>, &#123;<span class="attr">className</span>: <span class="string">"book"</span>&#125;,</div><div class="line">                React.createElement(<span class="string">"h3"</span>, <span class="literal">null</span>, <span class="keyword">this</span>.props.author),</div><div class="line">                React.createElement(<span class="string">"div"</span>, &#123;<span class="attr">className</span>: <span class="string">"lead"</span>&#125;, <span class="keyword">this</span>.props.children.toString())</div><div class="line">            )</div><div class="line">        );</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>런타임시 위의 JavaScript 코드는 적절한 HTML로 렌더링됩니다.</p>
<p><em>app.html</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"book"</span> <span class="attr">data-reactid</span>=<span class="string">".1c3dv7jhtco.1.$0"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">h3</span> <span class="attr">data-reactid</span>=<span class="string">".1c3dv7jhtco.1.$0.0"</span>&gt;</span>George Orwell<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"lead"</span> <span class="attr">data-reactid</span>=<span class="string">".1c3dv7jhtco.1.$0.1"</span>&gt;</span>1984<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>React는 데이터 변경시 data-reactid 속성을 통해 변경해야하는 (가상) DOM 부분을 찾을 수 있습니다.</p>
<blockquote>
<p>React.js, JSX 및 Flux에 대한 자세한 내용은 해당 웹 사이트를 참조하십시오!</p>
</blockquote>
<h3 id="5-3-Isomorphic-App을-위한-Spring-Boot-MVC"><a href="#5-3-Isomorphic-App을-위한-Spring-Boot-MVC" class="headerlink" title="5.3. Isomorphic App을 위한 Spring Boot MVC"></a>5.3. Isomorphic App을 위한 Spring Boot MVC</h3><p>서버 측 렌더링을 위해 Spring (Boot) MVC 및 React.js를 사용하는 예제가 몇 가지 있습니다.</p>
<ul>
<li><a href="https://github.com/sdeleuze/spring-react-isomorphic" target="_blank" rel="external">sdeleuze/spring-react-isomorphic</a></li>
<li><a href="https://github.com/winterbe/spring-react-example" target="_blank" rel="external">winterbe/spring-react-example</a></li>
</ul>
<blockquote>
<p>Spring MVC로 Isomorphic 응용 프로그램을 만드는 데 관심이 있다면이 위의 링크들을 참조하십시오.</p>
</blockquote>
<h3 id="5-4-Isomorphic-App을-위한-Java-EE-8-MVC-1-0"><a href="#5-4-Isomorphic-App을-위한-Java-EE-8-MVC-1-0" class="headerlink" title="5.4. Isomorphic App을 위한 Java EE 8 MVC 1.0"></a>5.4. Isomorphic App을 위한 Java EE 8 MVC 1.0</h3><p>Java EE 8과 그 참조 구현인 <a href="https://ozark.java.net/" target="_blank" rel="external">Ozark</a>에서 Action-based Web-Framework <a href="https://java.net/projects/mvc-spec/pages/Home" target="_blank" rel="external">MVC 1.0</a>을 새로 만들기 위해 React.js의 튜토리얼을 참고하여 ViewEngine 예제를 작성했습니다.</p>
<ul>
<li><a href="https://github.com/dasniko/ozark-react" target="_blank" rel="external">dasniko/ozark-react</a></li>
<li><a href="https://github.com/dasniko/ozark-react-example" target="_blank" rel="external">dasniko/ozark-react-example</a></li>
</ul>
<p>위의 두 저장소에서 가져온 아래 간단한 코드 조각은 JavaScript/Java EE 애플리케이션이 어떻게 Isomorphic으로 구현이 되는지 보여줍니다.</p>
<blockquote>
<p>React 기반 ViewEngine을 사용하여 응용 프로그램을 만들때 위에서 언급한 저장소의 원래 코드를 사용해야합니다. 원래 코드들은 아래의 단순화된 예제보다 훨씬 더 유연하고 강력합니다!</p>
</blockquote>
<p>ReactController는 새로운 <code>@Controller</code> 어노테이션을 사용한 표준 MVC 컨트롤러입니다.</p>
<p><em>ReactController.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span> <span class="comment">// --- (1)</span></div><div class="line"><span class="meta">@Path</span>(<span class="string">"/react"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="keyword">private</span> Models models; <span class="comment">// --- (2)</span></div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    <span class="keyword">private</span> BookService service; <span class="comment">// --- (3)</span></div><div class="line"></div><div class="line">    <span class="meta">@GET</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        List&lt;Book&gt; books = service.getBooks();</div><div class="line">        models.put(<span class="string">"data"</span>, books); <span class="comment">// --- (4)</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"react:react.jsp"</span>; <span class="comment">// --- (5)</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>MVC 컨트롤러 어노테이션</li>
<li>Map 형식의 MVC 내부 Model Entity</li>
<li>데이터를 조회하거나 저장하는 서비스</li>
<li>Book list를 가져와서 Java 오브젝트를 Model에 넣습니다.</li>
<li>ReactViewEngine이 사용할 <code>react:</code> 접두어가 있는 템플릿의 Path를 반환합니다.</li>
</ol>
<p>아래 예제가 React.js와 상호 작용하는 실제 ViewEngine 구현 클래스 입니다.</p>
<p><em>ReactViewEngine.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReactViewEngine</span> <span class="keyword">extends</span> <span class="title">ServletViewEngine</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String viewPrefix = <span class="string">"react:"</span>;</div><div class="line"></div><div class="line">    <span class="meta">@Inject</span></div><div class="line">    React react; <span class="comment">// --- (1)</span></div><div class="line"></div><div class="line">    ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper();</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(String view)</span> </span>&#123; <span class="comment">// --- (2)</span></div><div class="line">        <span class="keyword">return</span> view.startsWith(viewPrefix);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processView</span><span class="params">(ViewEngineContext context)</span> <span class="keyword">throws</span> ViewEngineException </span>&#123; <span class="comment">// --- (3)</span></div><div class="line">        <span class="comment">// parse view and extract the actual template</span></div><div class="line">        String template = context.getView().substring(viewPrefix.length());</div><div class="line"></div><div class="line">        <span class="comment">// get "data" from model</span></div><div class="line">        Models models = context.getModels();</div><div class="line">        Object data = models.get(<span class="string">"data"</span>);</div><div class="line"></div><div class="line">        <span class="comment">// call js function on data to generate html</span></div><div class="line">        String content = react.render(data);</div><div class="line"></div><div class="line">        <span class="comment">// and put results as string in model</span></div><div class="line">        models.put(<span class="string">"content"</span>, content);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// additionally put the data as JSON also to the model</span></div><div class="line">            <span class="comment">// this overrides the List data stored previously under the same key</span></div><div class="line">            models.put(<span class="string">"data"</span>, mapper.writeValueAsString(data));</div><div class="line">        &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ViewEngineException(e);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// create a new context with the actual view and forward to ServletViewEngine</span></div><div class="line">        ViewEngineContext ctx = <span class="keyword">new</span> ViewEngineContextImpl(template, models,</div><div class="line">                context.getRequest(), context.getResponse(), context.getUriInfo(),</div><div class="line">                context.getResourceInfo(), context.getConfiguration());</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            forwardRequest(ctx, <span class="string">"*.jsp"</span>, <span class="string">"*.jspx"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (ServletException | IOException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ViewEngineException(e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li><code>React</code> 클래스는 React.js JavaScript 코드와 상호 작용합니다. (자세한 내용은 아래 클래스를 참조하십시오.)</li>
<li><code>supports()</code> 메서드는 이 <code>ReactViewEngine</code> 클래스가 컨트롤러의 리턴 문자열에 적합한 ViewEngine으로 사용되어도 되는지 여부를 판단 합니다.</li>
<li><code>processView()</code> 메서드는 실제로 View를 처리하기 위한 일을 합니다. 자세한 내용은 인라인 주석을 참조하십시오.</li>
</ol>
<p>아래 <code>React</code> 클래스는 JavaScript React.js와 상호 작용하는 클래스입니다.</p>
<p><em>React.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">React</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> ThreadLocal&lt;ScriptEngine&gt; engineHolder = ThreadLocal.withInitial(() -&gt; &#123; <span class="comment">// --- (1)</span></div><div class="line">        ScriptEngine nashorn = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">"nashorn"</span>);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            nashorn.eval(read(<span class="string">"/nashorn-polyfill.js"</span>));</div><div class="line">            nashorn.eval(read(<span class="string">"/META-INF/resources/webjars/react/0.14.2/react.min.js"</span>));</div><div class="line">            nashorn.eval(read(</div><div class="line">                    <span class="string">"/META-INF/resources/webjars/showdown/0.3.1/compressed/showdown.js"</span>));</div><div class="line">            nashorn.eval(read(<span class="string">"/js/bookBox.js"</span>));</div><div class="line">        &#125; <span class="keyword">catch</span> (ScriptException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> nashorn;</div><div class="line">    &#125;);</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">render</span><span class="params">(Object object)</span> </span>&#123; <span class="comment">// --- (2)</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Object html =</div><div class="line">                    ((Invocable) engineHolder.get()).invokeFunction(<span class="string">"renderServer"</span>, object);</div><div class="line">            <span class="keyword">return</span> String.valueOf(html);</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"failed to render react component"</span>, e);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> Reader <span class="title">read</span><span class="params">(String path)</span> </span>&#123; <span class="comment">// --- (3)</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> InputStreamReader(getClass().getClassLoader().getResourceAsStream(path));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>필요한 JavaScript 라이브러리들과 함께 새로운 <code>ThreadLocal&lt;ScriptEngine&gt;</code>을 초기화 합니다. 왜냐하면 React.js는 Thread Safe하지 않기 때문에 각 요청에서 전용 ScriptEngine을 사용해야 합니다.</li>
<li>JSX/JS 코드의 renderServer 함수를 호출하고 결과를 문자열로 반환합니다 (아래 코드 참조).</li>
<li>중복 코드 제거를 위한 메서드</li>
</ol>
<p>아래 코드는 original JSX 코드입니다. (Nashorn에 로드하기 전에 JS로 렌더링 됨, Babel.js 라이브러리를 빌드 도중 또는 런타임에 Nashorn ScriptEngine에 로드할 수 있지만 로드 시간이 더 길어질 수 있음).</p>
<p><em>bookBox.jsx</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">... <span class="comment">// --- (1)</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> renderClient = <span class="function"><span class="keyword">function</span> (<span class="params">books</span>) </span>&#123; <span class="comment">// --- (2)</span></div><div class="line">    <span class="keyword">var</span> data = books || [];</div><div class="line">    React.render(</div><div class="line">        &lt;BookBox data=&#123;data&#125; url='books.json' pollInterval=&#123;5000&#125; /&gt;, // --- (4)</div><div class="line">        document.getElementById("content")</div><div class="line">    );</div><div class="line">&#125;;</div><div class="line"></div><div class="line">var renderServer = function (books) &#123; // --- (3)</div><div class="line">    var data = Java.from(books);</div><div class="line">    return React.renderToString(</div><div class="line">        &lt;BookBox data=&#123;data&#125; url='books.json' pollInterval=&#123;5000&#125; /&gt; // --- (4)</div><div class="line">    );</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<ol>
<li>이전 코드 생략.</li>
<li>이 함수는 클라이언트에 의해 호출되며 응용 프로그램을 초기화하고 컨텐츠를 렌더링합니다.</li>
<li>이 함수는 서버 (위 <code>React.java</code> 참조)에 의해 호출되어 컨텐츠를 렌더링합니다.</li>
<li><bookbox> Component는  (1)에 있는 생략된 코드입니다. 실제 isomorphic 코드입니다.</bookbox></li>
</ol>
<p>추가 정보가 포함된 HTML skeleton이 서버에서 렌더링되고 클라이언트에 전송됩니다.</p>
<p><em>react.jsp</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">contentType</span>=<span class="string">"text/html;charset=UTF-8"</span> <span class="attr">language</span>=<span class="string">"java"</span> %&gt;</span></div><div class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"IE=edge"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>ReactJS Bookstore with Ozark<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;mvc.contextPath&#125;/webjars/react/0.14.2/react.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> //--- (1)</div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;mvc.contextPath&#125;/webjars/showdown/0.3.1/compressed/showdown.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"$&#123;mvc.contextPath&#125;/webjars/jquery/1.11.3/jquery.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"$&#123;mvc.contextPath&#125;/webjars/bootstrap/3.3.5/css/bootstrap.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"content"</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span>$&#123;content&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span> // --- (2)</div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"$&#123;mvc.contextPath&#125;/js/bookBox.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> // --- (3)</div><div class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">        $(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">            renderClient($&#123;data&#125;); <span class="comment">// --- (4)</span></div><div class="line">        &#125;);</div><div class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ol>
<li>WebJars를 이용한 JavaScript 라이브러리 (Maven/Gradle 빌드 파일에서 dependency 설정)</li>
<li>Client 또는 Server에서 렌더링된 내용을 넣을 <code>div</code></li>
<li>실제 응용 프로그램 스크립트 (bookBox.jsx 참고)</li>
<li>응용 프로그램이 클라이언트 측에서 실행 또는 초기화 될 때 호출 되는 함수입니다 (bookBox.js 참고)</li>
</ol>
<p><code>ReactController</code>에서 <code>ReactViewEngine</code>을 호출하지 않고 애플리케이션이 시작된 경우 (예를 들어 “<code>react.jsp</code>“만 반환하면 표준 JSP ViewEngine을 사용합니다.), 서버에서 수신 받은 초기 데이터를 보면 <code>&lt;div id = &quot;content&quot;/&gt;</code> 엘리먼트에는 눈으로 확인할 수 있는 HTML 코드가 포함되어 있지 않습니다. 하지만 renderClient()를 클라이언트에서 호출하기 때문에 브라우저에서 렌더링되고 컨텐츠가 표시됩니다.</p>
<p>프로그램에서 ReactViewEngine을 사용하면 서버에서 받은 초기 코드의 <code>&lt;div id = &quot;content&quot;/&gt;</code> 엘리먼트에는 렌더링된 컨텐츠가 표시 됩니다.</p>
<p>클라이언트의 <code>renderClient()</code> 함수도 실행이 되지만 (가상) DOM에는 변경 사항이 없으므로 페이지가 그대로 유지되고, DOM이 다시 렌더링되지 않아 깜박임 현상이 없어집니다.</p>
<h2 id="6-JavaFX-with-JavaScript"><a href="#6-JavaFX-with-JavaScript" class="headerlink" title="6.JavaFX with JavaScript"></a>6.JavaFX with JavaScript</h2><p><a href="http://www.n-k.de/riding-the-nashorn/#_javafx_with_javascript" target="_blank" rel="external">http://www.n-k.de/riding-the-nashorn/#_javafx_with_javascript</a></p>
<blockquote>
<p>JavaFx는 한국에서 별로 인기가 없어서 따로 번역을 하지 않았습니다.<br>자세한 설명은 원문을 참고하세요.</p>
</blockquote>
<h2 id="7-Nashorn-Script-테스트와-디버깅-하기"><a href="#7-Nashorn-Script-테스트와-디버깅-하기" class="headerlink" title="7. Nashorn Script 테스트와 디버깅 하기"></a>7. Nashorn Script 테스트와 디버깅 하기</h2><h3 id="7-1-Testing"><a href="#7-1-Testing" class="headerlink" title="7.1. Testing"></a>7.1. Testing</h3><p>Nashorn 스크립트의 테스트는 아직 사용해 보지 않아서 어려워 보일수 있지만 그렇지 않습니다.</p>
<h4 id="7-1-1-Function-al-testing-with-JUnit"><a href="#7-1-1-Function-al-testing-with-JUnit" class="headerlink" title="7.1.1. Function(al) testing with JUnit"></a>7.1.1. Function(al) testing with JUnit</h4><p>모든 JavaScript 함수에는 반환 값이 있으므로 (모든 JavaScript 함수, 명시 적 반환 값이없는 함수조차도 undefined를 반환합니다) 이러한 값을 지정할 수 있습니다.<br>Java 메서드를 개발하는 것처럼 JavaScript 파일을 빌드, 테스트 가능한 atomic 함수로 작업하면됩니다.<br>그런 다음 테스트에서 JavaScript 함수를 호출하고 결과를 assert 선언할 수 있습니다.</p>
<p>다음 JavaScript 코드가 있다고 가정 해 보겠습니다.</p>
<p><em>calculator.js</em><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> add = <span class="function"><span class="keyword">function</span>(<span class="params">a, b</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> a + b;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> square = <span class="function"><span class="keyword">function</span>(<span class="params">a</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> a * a;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>이제 다음 표준 JUnit 테스트를 사용하여 함수를 테스트할 수 있습니다</p>
<p><em>CalculatorTest.java</em><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</div><div class="line"></div><div class="line">    ScriptEngine nashorn;</div><div class="line"></div><div class="line">    <span class="meta">@Before</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setup</span><span class="params">()</span> </span>&#123;</div><div class="line">        nashorn = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">"nashorn"</span>);</div><div class="line">        nashorn.eval(<span class="keyword">new</span> InputStreamReader(</div><div class="line">                getClass().getClassLoader().getResourceAsStream(<span class="string">"/calculator.js"</span>)));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        Object result = ((Invocable) nashorn).invokeFunction(<span class="string">"add"</span>, <span class="number">1</span>, <span class="number">2</span>);</div><div class="line">        Assert.assertEquals(<span class="number">1</span>, result);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSquare</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        Object result = ((Invocable) nashorn).invokeFunction(<span class="string">"square"</span>, <span class="number">2</span>);</div><div class="line">        Assert.assertEquals(<span class="number">4</span>, result);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="7-1-2-Mocking-JavaScript-functions-amp-using-Spock"><a href="#7-1-2-Mocking-JavaScript-functions-amp-using-Spock" class="headerlink" title="7.1.2. Mocking JavaScript functions &amp; using Spock"></a>7.1.2. Mocking JavaScript functions &amp; using Spock</h4><p>Nashorn 스크립트를 테스트하는 훨씬 더 좋은 (더 강력한) 방법은 JUnit 대신 <a href="https://code.google.com/archive/p/spock/" target="_blank" rel="external">Spock</a>을 사용하는 것입니다. Spock은 동적언어 Groovy 코드를 기반으로 작성되었습니다. 그렇기 때문에 Groovy로 만든 객체와 함수를 Nashorn과 테스트 하기 쉽습니다</p>
<p>Spock을 사용하면 직접 제어할 수 없거나 Nashorn에서 사용할 수없는 기능에 대해 mock function을 사용하기가 매우 쉽습니다. 이런 제어할수 없는 기능들 중에는 테스트 중에는 실행하고 싶지 않은 콜백 함수 (JavaScript에서 널리 사용됨), alert() 함수 등이 있을수 있습니다.</p>
<p><em>Callback.groovy</em><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CallbackSpec</span> &#123;</span></div><div class="line"></div><div class="line">    <span class="meta">@Shared</span> ScriptEngine nashorn = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">'nashorn'</span>);</div><div class="line"></div><div class="line">    <span class="keyword">def</span> <span class="string">"callback"</span>() &#123; <span class="comment">// -- (1)</span></div><div class="line"><span class="symbol">        given:</span></div><div class="line">        nashorn.eval(<span class="string">'function callMe(callback) &#123; return callback("") + " Doe"; &#125;'</span>)</div><div class="line"><span class="symbol"></span></div><div class="line">        when:</div><div class="line">        <span class="keyword">def</span> result = nashorn.invokeFunction(<span class="string">'callMe'</span>, &#123; <span class="keyword">return</span> <span class="string">'John'</span> &#125; <span class="keyword">as</span> Function)</div><div class="line"><span class="symbol"></span></div><div class="line">        then:</div><div class="line">        result == <span class="string">'John Doe'</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">def</span> <span class="string">"mocked callback"</span>() &#123; <span class="comment">// -- (2)</span></div><div class="line"><span class="symbol">        given:</span></div><div class="line">        nashorn.eval(<span class="string">'function callMe(callback) &#123; return callback("") + " Doe"; &#125;'</span>)</div><div class="line">        <span class="keyword">def</span> callback = Mock(Function)</div><div class="line"><span class="symbol"></span></div><div class="line">        when:</div><div class="line">        <span class="keyword">def</span> result = nashorn.invokeFunction(<span class="string">'callMe'</span>, callback)</div><div class="line"><span class="symbol"></span></div><div class="line">        then:</div><div class="line">        <span class="number">1</span> * callback.apply(<span class="string">''</span>) &gt;&gt; <span class="string">'John'</span></div><div class="line">        result == <span class="string">'John Doe'</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">def</span> <span class="string">"alert"</span>() &#123; <span class="comment">// -- (3)</span></div><div class="line"><span class="symbol">        given:</span></div><div class="line">        nashorn.eval(<span class="string">'function alertMe() &#123; alert("Huh!"); &#125;'</span>)</div><div class="line">        <span class="keyword">def</span> alert = Mock(Function)</div><div class="line">        nashorn.put(<span class="string">'alert'</span>, alert)</div><div class="line"><span class="symbol"></span></div><div class="line">        when:</div><div class="line">        nashorn.invokeFunction(<span class="string">'alertMe'</span>)</div><div class="line"><span class="symbol"></span></div><div class="line">        then:</div><div class="line">        <span class="number">1</span> * alert.apply(<span class="string">'Huh!'</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>이 함수는 테스트 호출시 inject된 다른 콜백 함수 (java.util.function.Function 유형)를 가져옵니다.</li>
<li>이 함수에서 콜백 함수는 mock 함수로 대체 되고,  mock 함수가 “John”값으로 한 번 호출된 이후에 테스트됩니다.</li>
<li>Nashorn에는 사용할수 있는 alert() 함수가 없기 때문에 실제 함수가 호출되기 전에 Nashorn context에 추가해야합니다.</li>
</ol>
<blockquote>
<p>Spock과 Nashorn의 더 많은 예제는 GitHub 저장소 <a href="https://github.com/dasniko/nashorn-spock-jasmine" target="_blank" rel="external">dasniko/nashorn-spock-jasmine</a>에서 찾을 수 있습니다.</p>
</blockquote>
<h3 id="7-2-Debugging"><a href="#7-2-Debugging" class="headerlink" title="7.2. Debugging"></a>7.2. Debugging</h3><p>Nashorn JavaScript의 디버깅은 다음과 같은 주요 IDE에서 지원됩니다.</p>
<ul>
<li>JetBrains IntelliJ IDEA (13.1 이상)<ul>
<li><a href="https://blog.jetbrains.com/idea/2014/03/debugger-for-jdk8s-nashorn-javascript-in-intellij-idea-13-1/" target="_blank" rel="external">https://blog.jetbrains.com/idea/2014/03/debugger-for-jdk8s-nashorn-javascript-in-intellij-idea-13-1/</a></li>
</ul>
</li>
<li>Oracle Netbeans (version 8 이상)<ul>
<li><a href="http://wiki.netbeans.org/NetBeans_80_NewAndNoteworthy#JavaScript_in_Nashorn" target="_blank" rel="external">http://wiki.netbeans.org/NetBeans_80_NewAndNoteworthy#JavaScript_in_Nashorn</a></li>
<li><a href="https://blogs.oracle.com/geertjan/entry/youtube_debugger_for_jdk8_s" target="_blank" rel="external">https://blogs.oracle.com/geertjan/entry/youtube_debugger_for_jdk8_s</a></li>
<li><a href="https://blogs.oracle.com/sundararajan/entry/remote_debugging_of_nashorn_scripts" target="_blank" rel="external">https://blogs.oracle.com/sundararajan/entry/remote_debugging_of_nashorn_scripts</a></li>
</ul>
</li>
<li>Eclipse<ul>
<li><a href="https://github.com/Nodeclipse/nodeclipse-1" target="_blank" rel="external">Nodeclipse</a>로 가능 합니다.</li>
</ul>
</li>
</ul>
<hr>
<h1 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h1><ul>
<li><a href="http://www.n-k.de/riding-the-nashorn/" target="_blank" rel="external">Riding the Nashorn: Programming JavaScript on the JVM</a></li>
<li><a href="http://winterbe.com/posts/2014/04/05/java8-nashorn-tutorial/" target="_blank" rel="external">Java 8 Nashorn Tutorial</a></li>
<li><a href="https://nodejs.github.io/nodejs-ko/articles/2015/06/17/npm-is-massive/" target="_blank" rel="external">NPM is Massive</a></li>
<li><a href="http://isomorphic.net/javascript" target="_blank" rel="external">Isomorphic JavaScript</a></li>
</ul>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://infoscis.github.io/2017/03/23/Riding-the-Nashorn/" data-id="cjkl90zz80001jguzc18ofdd9" class="article-share-link"><i class="fa fa-share"></i>공유하기</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>팔로우:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/infoscis" target="_blank">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2017/03/24/First-steps-with-java9-and-jigsaw-part-1/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">새로운</strong>
        <p class="article-nav-title">
        
            Java 9 와 Project Jigsaw 소개 1
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
</nav>

    
    <div class="widgets-container">
        
            
                
    <div class="widget-wrap">
        <h3 class="widget-title">최근 글</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Angular/">Angular</a></p>
                            <p class="item-title"><a href="/2018/08/08/angular-observables-and-rxjs/" class="title">Angular Observable &amp; RxJS</a></p>
                            <p class="item-date"><time datetime="2018-08-08T14:38:02.000Z" itemprop="datePublished">2018-08-08</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JavaScript/">JavaScript</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/JavaScript/ECMAScript-2015/">ECMAScript 2015</a></p>
                            <p class="item-title"><a href="/2018/02/27/ecmascript-6-appendix-b-understanding-ecmascript-7/" class="title">ECMAScript 6 부록 B. ECMAScript 7 (2016) 이해하기</a></p>
                            <p class="item-date"><time datetime="2018-02-27T13:32:48.000Z" itemprop="datePublished">2018-02-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JavaScript/">JavaScript</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/JavaScript/ECMAScript-2015/">ECMAScript 2015</a></p>
                            <p class="item-title"><a href="/2018/02/27/ecmascript-6-appendix-a-smaller-changes/" class="title">ECMAScript 6 부록 A. 작은 변경 사항</a></p>
                            <p class="item-date"><time datetime="2018-02-27T13:32:12.000Z" itemprop="datePublished">2018-02-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JavaScript/">JavaScript</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/JavaScript/ECMAScript-2015/">ECMAScript 2015</a></p>
                            <p class="item-title"><a href="/2018/02/27/ecmascript-6-encapsulating-code-with-modules/" class="title">ECMAScript 6 Module로 코드 캡슐화하기</a></p>
                            <p class="item-date"><time datetime="2018-02-27T13:31:45.000Z" itemprop="datePublished">2018-02-27</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/JavaScript/">JavaScript</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/JavaScript/ECMAScript-2015/">ECMAScript 2015</a></p>
                            <p class="item-title"><a href="/2018/02/27/ecmascript-6-proxies-and-the-reflection-api/" class="title">ECMAScript 6 프록시와 리플렉션 API</a></p>
                            <p class="item-date"><time datetime="2018-02-27T13:31:03.000Z" itemprop="datePublished">2018-02-27</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">카테고리</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Angular/">Angular</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hadoop/">Hadoop</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Java9/">Java9</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Spring/">Spring</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/">JavaScript</a><span class="category-list-count">16</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JavaScript/ECMAScript-2015/">ECMAScript 2015</a><span class="category-list-count">15</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/TypeScript/">TypeScript</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Webpack/">Webpack</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">아카이브</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">8월 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">2월 2018</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">1월 2018</a><span class="archive-list-count">11</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">7월 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">6월 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">5월 2017</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">3월 2017</a><span class="archive-list-count">5</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">태그</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/">Angular</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ECMAScript-2015/">ECMAScript 2015</a><span class="tag-list-count">15</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Event/">Event</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hadoop/">Hadoop</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDK9/">JDK9</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java9/">Java9</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a><span class="tag-list-count">29</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jigsaw/">Jigsaw</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nashorn/">Nashorn</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/">Spring</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/">SpringBoot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TypeScript/">TypeScript</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YARN/">YARN</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">태그 클라우드</h3>
        <div class="widget tagcloud">
            <a href="/tags/Angular/" style="font-size: 18px;">Angular</a> <a href="/tags/ECMAScript-2015/" style="font-size: 18px;">ECMAScript 2015</a> <a href="/tags/Event/" style="font-size: 10px;">Event</a> <a href="/tags/Hadoop/" style="font-size: 10px;">Hadoop</a> <a href="/tags/JDK9/" style="font-size: 12px;">JDK9</a> <a href="/tags/Java/" style="font-size: 14px;">Java</a> <a href="/tags/Java9/" style="font-size: 12px;">Java9</a> <a href="/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/tags/Jigsaw/" style="font-size: 12px;">Jigsaw</a> <a href="/tags/Nashorn/" style="font-size: 10px;">Nashorn</a> <a href="/tags/Spring/" style="font-size: 12px;">Spring</a> <a href="/tags/SpringBoot/" style="font-size: 10px;">SpringBoot</a> <a href="/tags/TypeScript/" style="font-size: 16px;">TypeScript</a> <a href="/tags/Webpack/" style="font-size: 10px;">Webpack</a> <a href="/tags/YARN/" style="font-size: 10px;">YARN</a>
        </div>
    </div>


            
        
    </div>
</aside>
                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 Jongcheol-Kim</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'infoscis';
    
    
    var disqus_url = 'http://infoscis.github.io/2017/03/23/Riding-the-Nashorn/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    


<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
